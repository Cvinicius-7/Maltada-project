"use strict";(self.webpackChunkecos_project=self.webpackChunkecos_project||[]).push([[855],{3236:(e,t,r)=>{r.r(t),r.d(t,{default:()=>C});var a=r(5043),i=r(5895),n=r(9806),o=r(3969),s=r(3089),l=r(4799),c=r(7873),d=r(3759),h=r(4527),p=r(298),x=r(2097),g=r(8729),m=r(5767),v=r(160),u=r(9992),f=r(579);const A=(0,u.A)([(0,f.jsx)("path",{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6"},"0"),(0,f.jsx)("path",{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12m0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17"},"1")],"AdminPanelSettings"),b=(0,u.A)((0,f.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Email"),w=(0,u.A)((0,f.jsx)("path",{d:"M20 7h-5V4c0-1.1-.9-2-2-2h-2c-1.1 0-2 .9-2 2v3H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2M9 12c.83 0 1.5.67 1.5 1.5S9.83 15 9 15s-1.5-.67-1.5-1.5S8.17 12 9 12m3 6H6v-.75c0-1 2-1.5 3-1.5s3 .5 3 1.5zm1-9h-2V4h2zm5 7.5h-4V15h4zm0-3h-4V12h4z"}),"Badge");var y=r(5727),j=r(8163),_=r(5272),S=r(7381);const C=()=>{const e=(0,j.Zp)(),{logout:t}=(0,g.A)(),r=localStorage.getItem("user"),u=r?JSON.parse(r).user:null,{getUserReviews:C,loading:I}=(0,S.A)(),[k,R]=(0,a.useState)([]),[W,M]=(0,a.useState)(5);if((0,a.useEffect)(()=>{null!==u&&void 0!==u&&u.id&&C(u.id).then(e=>R(e))},[]),!u)return(0,f.jsx)(i.A,{children:"Carregando perfil..."});const L=1===u.role,V=L?"Administrador":"Cervejeiro",N=L?"secondary":"primary",z=u.email?u.email[0].toUpperCase():"U",E=e=>((e.aroma+e.appearance+e.flavor+e.mouthfeel+e.impression)/5).toFixed(1);return(0,f.jsxs)(n.A,{maxWidth:"md",children:[(0,f.jsx)(o.A,{sx:{mb:4,textAlign:"center"},children:(0,f.jsx)(i.A,{variant:"h4",sx:{fontWeight:"bold",color:"#f6b033"},children:"Meu Perfil"})}),(0,f.jsx)(s.A,{container:!0,spacing:3,justifyContent:"center",children:(0,f.jsx)(s.A,{item:!0,xs:12,md:8,children:(0,f.jsxs)(l.A,{elevation:3,sx:{p:4,borderRadius:4},children:[(0,f.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:4},children:[(0,f.jsx)(c.A,{src:u.avatar_url,sx:{width:120,height:120,bgcolor:"#f6b033",fontSize:"3.5rem",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",mb:2,color:"#fff"},children:z}),(0,f.jsx)(i.A,{variant:"h5",sx:{fontWeight:"bold"},children:u.full_name||u.email.split("@")[0]}),(0,f.jsx)(d.A,{icon:L?(0,f.jsx)(A,{}):(0,f.jsx)(v.A,{}),label:V,color:N,variant:"outlined",sx:{mt:1,fontWeight:"bold"}})]}),(0,f.jsx)(h.A,{sx:{mb:4},children:"Dados da Conta"}),(0,f.jsxs)(p.A,{spacing:3,children:[(0,f.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,f.jsx)(c.A,{sx:{bgcolor:"rgba(0,0,0,0.05)",color:"text.secondary"},children:(0,f.jsx)(b,{})}),(0,f.jsxs)(o.A,{children:[(0,f.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"E-mail"}),(0,f.jsx)(i.A,{variant:"body1",children:u.email})]})]}),(0,f.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,f.jsx)(c.A,{sx:{bgcolor:"rgba(0,0,0,0.05)",color:"text.secondary"},children:(0,f.jsx)(w,{})}),(0,f.jsxs)(o.A,{children:[(0,f.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"ID de Usu\xe1rio"}),(0,f.jsx)(i.A,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.9rem"},children:u.id})]})]})]}),(0,f.jsx)(h.A,{sx:{my:4}}),(0,f.jsxs)(p.A,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"center",children:[(0,f.jsx)(x.A,{variant:"outlined",color:"primary",startIcon:(0,f.jsx)(v.A,{}),onClick:()=>e("/edit-profile"),sx:{borderRadius:2,px:4,textTransform:"none"},children:"Editar Dados"}),(0,f.jsx)(x.A,{variant:"contained",color:"error",startIcon:(0,f.jsx)(m.A,{}),onClick:t,sx:{borderRadius:2,px:4,textTransform:"none"},children:"Sair da Conta"})]}),(0,f.jsx)(h.A,{sx:{mb:4,mt:4}}),(0,f.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[(0,f.jsx)(y.A,{color:"primary"}),(0,f.jsxs)(i.A,{variant:"h6",fontWeight:"bold",children:["Minhas Avalia\xe7\xf5es (",k.length,")"]})]}),I?(0,f.jsx)(i.A,{children:"Carregando avalia\xe7\xf5es..."}):0===k.length?(0,f.jsx)(i.A,{color:"text.secondary",align:"center",sx:{py:2},children:"Voc\xea ainda n\xe3o avaliou nenhuma cerveja."}):(0,f.jsxs)(p.A,{spacing:2,children:[k.slice(0,W).map(t=>{var r,a;return(0,f.jsxs)(l.A,{elevation:0,sx:{p:2,border:"1px solid #eee",display:"flex",gap:2,alignItems:"flex-start",cursor:"pointer","&:hover":{bgcolor:"#f6af3370"}},onClick:()=>e("/beer/".concat(t.beer_id)),children:[(0,f.jsx)(c.A,{src:null===(r=t.beer)||void 0===r?void 0:r.image,variant:"rounded",sx:{width:60,height:60,bgcolor:"rgba(0,0,0,0.05)"},children:"\ud83c\udf7a"}),(0,f.jsxs)(o.A,{sx:{flex:1},children:[(0,f.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,f.jsx)(i.A,{variant:"subtitle1",fontWeight:"bold",children:(null===(a=t.beer)||void 0===a?void 0:a.name)||"Cerveja"}),(0,f.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,f.jsx)(i.A,{fontWeight:"bold",color:"primary",children:E(t)}),(0,f.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"/ 10"})]})]}),(0,f.jsxs)(i.A,{variant:"body2",color:"text.secondary",sx:{mb:1,fontStyle:"italic"},children:['"',t.comment,'"']}),(0,f.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:["Avaliado em"," ",new Date(t.created_at).toLocaleDateString()]})]})]},t.id)}),k.length>W&&(0,f.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,f.jsxs)(x.A,{variant:"text",onClick:()=>{M(e=>e+5)},endIcon:(0,f.jsx)(_.A,{}),sx:{color:"text.secondary",textTransform:"none"},children:["Mostrar avalia\xe7\xf5es anteriores (",k.length-W," restantes)"]})})]})]})})})]})}},4527:(e,t,r)=>{r.d(t,{A:()=>u});var a=r(9379),i=r(45),n=r(5043),o=r(8387),s=r(1807),l=r(8128),c=r(1612),d=r(8301),h=r(4171),p=r(579);const x=["absolute","children","className","orientation","component","flexItem","light","role","textAlign","variant"],g=(0,l.Ay)("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.absolute&&t.absolute,t[r.variant],r.light&&t.light,"vertical"===r.orientation&&t.vertical,r.flexItem&&t.flexItem,r.children&&t.withChildren,r.children&&"vertical"===r.orientation&&t.withChildrenVertical,"right"===r.textAlign&&"vertical"!==r.orientation&&t.textAlignRight,"left"===r.textAlign&&"vertical"!==r.orientation&&t.textAlignLeft]}})((0,c.A)(e=>{let{theme:t}=e;return{margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(t.vars||t).palette.divider,borderBottomWidth:"thin",variants:[{props:{absolute:!0},style:{position:"absolute",bottom:0,left:0,width:"100%"}},{props:{light:!0},style:{borderColor:t.alpha((t.vars||t).palette.divider,.08)}},{props:{variant:"inset"},style:{marginLeft:72}},{props:{variant:"middle",orientation:"horizontal"},style:{marginLeft:t.spacing(2),marginRight:t.spacing(2)}},{props:{variant:"middle",orientation:"vertical"},style:{marginTop:t.spacing(1),marginBottom:t.spacing(1)}},{props:{orientation:"vertical"},style:{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"}},{props:{flexItem:!0},style:{alignSelf:"stretch",height:"auto"}},{props:e=>{let{ownerState:t}=e;return!!t.children},style:{display:"flex",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}}},{props:e=>{let{ownerState:t}=e;return t.children&&"vertical"!==t.orientation},style:{"&::before, &::after":{width:"100%",borderTop:"thin solid ".concat((t.vars||t).palette.divider),borderTopStyle:"inherit"}}},{props:e=>{let{ownerState:t}=e;return"vertical"===t.orientation&&t.children},style:{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:"thin solid ".concat((t.vars||t).palette.divider),borderLeftStyle:"inherit"}}},{props:e=>{let{ownerState:t}=e;return"right"===t.textAlign&&"vertical"!==t.orientation},style:{"&::before":{width:"90%"},"&::after":{width:"10%"}}},{props:e=>{let{ownerState:t}=e;return"left"===t.textAlign&&"vertical"!==t.orientation},style:{"&::before":{width:"10%"},"&::after":{width:"90%"}}}]}})),m=(0,l.Ay)("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.wrapper,"vertical"===r.orientation&&t.wrapperVertical]}})((0,c.A)(e=>{let{theme:t}=e;return{display:"inline-block",paddingLeft:"calc(".concat(t.spacing(1)," * 1.2)"),paddingRight:"calc(".concat(t.spacing(1)," * 1.2)"),whiteSpace:"nowrap",variants:[{props:{orientation:"vertical"},style:{paddingTop:"calc(".concat(t.spacing(1)," * 1.2)"),paddingBottom:"calc(".concat(t.spacing(1)," * 1.2)")}}]}})),v=n.forwardRef(function(e,t){const r=(0,d.b)({props:e,name:"MuiDivider"}),{absolute:n=!1,children:l,className:c,orientation:v="horizontal",component:u=(l||"vertical"===v?"div":"hr"),flexItem:f=!1,light:A=!1,role:b=("hr"!==u?"separator":void 0),textAlign:w="center",variant:y="fullWidth"}=r,j=(0,i.A)(r,x),_=(0,a.A)((0,a.A)({},r),{},{absolute:n,component:u,flexItem:f,light:A,orientation:v,role:b,textAlign:w,variant:y}),S=(e=>{const{absolute:t,children:r,classes:a,flexItem:i,light:n,orientation:o,textAlign:l,variant:c}=e,d={root:["root",t&&"absolute",c,n&&"light","vertical"===o&&"vertical",i&&"flexItem",r&&"withChildren",r&&"vertical"===o&&"withChildrenVertical","right"===l&&"vertical"!==o&&"textAlignRight","left"===l&&"vertical"!==o&&"textAlignLeft"],wrapper:["wrapper","vertical"===o&&"wrapperVertical"]};return(0,s.A)(d,h.K,a)})(_);return(0,p.jsx)(g,(0,a.A)((0,a.A)({as:u,className:(0,o.A)(S.root,c),role:b,ref:t,ownerState:_,"aria-orientation":"separator"!==b||"hr"===u&&"vertical"!==v?void 0:v},j),{},{children:l?(0,p.jsx)(m,{className:S.wrapper,ownerState:_,children:l}):null}))});v&&(v.muiSkipListHighlight=!0);const u=v},5272:(e,t,r)=>{r.d(t,{A:()=>n});var a=r(9992),i=r(579);const n=(0,a.A)((0,i.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore")},5727:(e,t,r)=>{r.d(t,{A:()=>n});var a=r(9992),i=r(579);const n=(0,a.A)((0,i.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 14v-2.47l6.88-6.88c.2-.2.51-.2.71 0l1.77 1.77c.2.2.2.51 0 .71L8.47 14zm12 0h-7.5l2-2H18z"}),"RateReview")},7381:(e,t,r)=>{r.d(t,{A:()=>c});var a=r(9379),i=r(5043),n=r(532),o=r(6547),s=r(8720),l=r(9099);const c=()=>{const[e,t]=i.useState([]),[r,c]=i.useState({}),[d,h]=i.useState(!1),{showToast:p}=(0,s.d)(),x=(0,i.useCallback)(async function(e,r,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"name_asc";h(!0);try{const{data:c,error:d}=await n.A.list("beer","*",e,r,i);if(d)throw d;if(c&&c.length>0){let e=await Promise.all(c.map(async e=>(e.image&&!e.image.startsWith("http")&&(e.image=await o.A.load(e.image,"beers")),e)));e=await(async e=>{const{data:t}=await l.N.from("beer_stats").select("*");return e.map(e=>{const r=null===t||void 0===t?void 0:t.find(t=>t.beer_id===e.id);return(0,a.A)((0,a.A)({},e),{},{rating:r?r.average_rating_10:null,reviews_count:r?r.review_count:0})})})(e),e.sort((e,t)=>{switch(s){case"price_asc":return(e.price||0)-(t.price||0);case"price_desc":return(t.price||0)-(e.price||0);case"rating_desc":return(t.rating||0)-(e.rating||0);case"rating_asc":return(e.rating||0)-(t.rating||0);case"name_desc":return t.name.localeCompare(e.name);default:return e.name.localeCompare(t.name)}}),t(e)}else t([])}catch(c){console.error("Erro ao listar:",c),t([])}finally{h(!1)}},[]),g=(0,i.useCallback)(async e=>{h(!0);try{const{data:t,error:r}=await n.A.get("beer",e);if(r)throw r;if(t){t.image&&!t.image.startsWith("http")&&(t.image=await o.A.load(t.image,"beers"));const{data:r}=await l.N.from("beer_stats").select("*").eq("beer_id",e).single(),{data:i}=await l.N.from("reviews").select("*, profiles:user_id(full_name, avatar_url)").eq("beer_id",e);let n=[];i&&i.length>0&&(n=await Promise.all(i.map(async e=>{var t;if(null!==(t=e.profiles)&&void 0!==t&&t.avatar_url&&!e.profiles.avatar_url.startsWith("http")){const t=await o.A.load(e.profiles.avatar_url,"images");e.profiles.avatar_url=t}return e}))),c((0,a.A)((0,a.A)({},t),{},{rating:r?r.average_rating_10:null,reviews_count:r?r.review_count:0,stats:r,reviews:n}))}}catch(t){c({})}finally{h(!1)}},[]),m=(0,i.useCallback)(async e=>{h(!0);try{const{data:t,error:r}=await l.N.from("reviews").select("*, beer:beer_id(id, name, image)").eq("user_id",e).order("created_at",{ascending:!1});if(r)throw r;if(t){return await Promise.all(t.map(async e=>(e.beer&&e.beer.image&&!e.beer.image.startsWith("http")&&(e.beer.image=await o.A.load(e.beer.image,"beers")),e)))}return[]}catch(t){return console.error("Erro ao buscar reviews do usu\xe1rio:",t),[]}finally{h(!1)}},[]),v=(0,i.useCallback)(async function(e,t,r,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;h(!0);try{let t,r=e.currentImagePath;if(e.image&&"object"===typeof e.image){const t=o.A.generateNameFile(e.name);r=await o.A.upload("beers",t,e.image)}e.year?t="".concat(e.year,"-01-01"):s||(t=new Date);const i=(0,a.A)({name:e.name,description:e.description,brewery:e.brewery,style:e.style,price:e.price,image:r},t?{created_at:t}:{});let c=null;if(s){c=(await n.A.update("beer",i,s)).error}else{c=(await n.A.create("beer",i)).error}if(c){var l;if("23505"===c.code||null!==(l=c.details)&&void 0!==l&&l.includes("already exists"))throw new Error("J\xe1 existe!");throw c}p("Salvo com sucesso!","success")}catch(c){p(c.message,"error")}finally{await x(t,r,i),h(!1)}},[x,p]),u=(0,i.useCallback)(async(e,t,r,a)=>{h(!0);try{const{error:t}=await n.A.delete("beer",e);if(t)throw t;p("Cerveja exclu\xedda!","success")}catch(i){p("Erro ao excluir.","error")}finally{await x(t,r,a),h(!1)}},[x,p]),f=(0,i.useCallback)(async(e,t)=>{h(!0);try{const{data:{user:r}}=await l.N.auth.getUser();if(!r)throw new Error("Usu\xe1rio n\xe3o logado.");const{error:i}=await l.N.from("reviews").insert((0,a.A)({beer_id:e,user_id:r.id},t));if(i)throw i;p("Nova avalia\xe7\xe3o registrada!","success"),await g(e)}catch(r){console.error("Erro ao avaliar:",r),p("Erro ao salvar avalia\xe7\xe3o: "+r.message,"error")}finally{h(!1)}},[g,p]);return{listBeers:x,findBeer:g,getUserReviews:m,saveBeer:v,deleteBeer:u,saveReview:f,beers:e,beer:r,loading:d}}}}]);
//# sourceMappingURL=855.477a528c.chunk.js.map