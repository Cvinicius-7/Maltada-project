"use strict";(self.webpackChunkecos_project=self.webpackChunkecos_project||[]).push([[991],{1991:(e,a,r)=>{r.r(a),r.d(a,{default:()=>O});var i=r(5043),t=r(8163),s=r(3969),l=r(5895),o=r(6020),n=r(3089),c=r(3759),d=r(4527),x=r(4799),m=r(2579),h=r(7873),u=r(2097),b=r(3023),p=r(8776),g=r(2055),A=r(7471),v=r(9801),f=r(6185),j=r(7381),w=r(8729),y=r(923),_=r(9243),C=r(7135),k=r(5727),S=r(102),W=r(9138),B=r(2043),R=r(1773),z=r(5362),E=r(9379),N=r(9958),I=r(298),P=r(6154),L=r(3699),q=r(149),F=r(3974),G=r(579);const U=e=>{let{label:a,value:r,max:i,onChange:t}=e;return(0,G.jsxs)(s.A,{sx:{mb:2},children:[(0,G.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,G.jsx)(l.A,{variant:"body2",fontWeight:"bold",children:a}),(0,G.jsxs)(l.A,{variant:"body2",color:"primary",fontWeight:"bold",children:[r,"/",i]})]}),(0,G.jsx)(N.Ay,{value:r,onChange:(e,a)=>t(a),min:0,max:i,step:1,valueLabelDisplay:"auto",sx:{color:"#ffffff",height:6}})]})},D=["Garrafa (Long Neck)","Garrafa (600ml)","Garrafa (1L)","Lata (350ml)","Lata (473ml)","Barril / Chopp (On Tap)","Growler","Outro"],T=e=>{let{onSave:a,onCancel:r}=e;const[t,s]=(0,i.useState)({aroma:5,appearance:3,flavor:10,mouthfeel:3,impression:5}),[o,n]=(0,i.useState)({comment:"",packaging:"Garrafa (Long Neck)",price_paid:""});return(0,G.jsxs)(x.A,{elevation:3,sx:{p:3,mb:4,bgcolor:"#f6b033",borderRadius:2,border:"1px solid #f6b033"},children:[(0,G.jsx)(l.A,{variant:"h6",gutterBottom:!0,fontWeight:"bold",sx:{mb:3},children:"Escreva sua Avalia\xe7\xe3o"}),(0,G.jsx)(U,{label:"\ud83d\udc43 Aroma (0-10)",value:t.aroma,max:10,onChange:e=>s((0,E.A)((0,E.A)({},t),{},{aroma:e}))}),(0,G.jsx)(U,{label:"\ud83d\udc40 Apar\xeancia (0-5)",value:t.appearance,max:5,onChange:e=>s((0,E.A)((0,E.A)({},t),{},{appearance:e}))}),(0,G.jsx)(U,{label:"\ud83d\udc45 Sabor (0-20)",value:t.flavor,max:20,onChange:e=>s((0,E.A)((0,E.A)({},t),{},{flavor:e}))}),(0,G.jsx)(U,{label:"\ud83d\udc44 Sensa\xe7\xe3o na Boca (0-5)",value:t.mouthfeel,max:5,onChange:e=>s((0,E.A)((0,E.A)({},t),{},{mouthfeel:e}))}),(0,G.jsx)(U,{label:"\ud83e\udde0 Impress\xe3o Geral (0-10)",value:t.impression,max:10,onChange:e=>s((0,E.A)((0,E.A)({},t),{},{impression:e}))}),(0,G.jsxs)(I.A,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2,mt:3},children:[(0,G.jsx)(P.A,{select:!0,label:"Embalagem / Tipo",fullWidth:!0,value:o.packaging,onChange:e=>n((0,E.A)((0,E.A)({},o),{},{packaging:e.target.value})),InputProps:{startAdornment:(0,G.jsx)(L.A,{position:"start",children:(0,G.jsx)(q.A,{fontSize:"small"})})},children:D.map(e=>(0,G.jsx)(A.A,{value:e,children:e},e))}),(0,G.jsx)(P.A,{label:"Pre\xe7o Pago (R$)",type:"number",fullWidth:!0,placeholder:"0.00",value:o.price_paid,onChange:e=>n((0,E.A)((0,E.A)({},o),{},{price_paid:e.target.value})),InputProps:{startAdornment:(0,G.jsx)(L.A,{position:"start",children:(0,G.jsx)(F.A,{fontSize:"small"})})}})]}),(0,G.jsx)(P.A,{label:"Coment\xe1rio (Opcional)",placeholder:"O que voc\xea achou dessa cerveja?",multiline:!0,rows:3,fullWidth:!0,value:o.comment,onChange:e=>n((0,E.A)((0,E.A)({},o),{},{comment:e.target.value})),sx:{mb:3}}),(0,G.jsxs)(I.A,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,G.jsx)(u.A,{onClick:r,color:"inherit",children:"Cancelar"}),(0,G.jsx)(u.A,{variant:"contained",color:"primary",onClick:()=>{a((0,E.A)((0,E.A)({},t),{},{comment:o.comment,packaging:o.packaging,price_paid:o.price_paid}))},children:"Publicar Avalia\xe7\xe3o"})]})]})},H=e=>{let{label:a,value:r,max:i}=e;return(0,G.jsxs)(s.A,{sx:{mb:1.5},children:[(0,G.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[(0,G.jsx)(l.A,{variant:"caption",fontWeight:"bold",children:a}),(0,G.jsxs)(l.A,{variant:"caption",sx:{color:"black",fontWeight:"bold"},children:[r||0," / ",i]})]}),(0,G.jsx)(o.A,{variant:"determinate",value:(r||0)/i*100,sx:{height:6,borderRadius:4,bgcolor:"#fbc568ff","& .MuiLinearProgress-bar":{bgcolor:"black"}}})]})},O=()=>{const{id:e}=(0,t.g)(),{findBeer:a,beer:r,loading:o,saveReview:E,updateReview:N,deleteReview:I}=(0,j.A)(),{user:P}=(0,w.A)(),[L,q]=(0,i.useState)(!1),[F,U]=(0,i.useState)(null),[D,O]=(0,i.useState)(null),[$,J]=(0,i.useState)(null),M=Boolean(D);(0,i.useEffect)(()=>{a(e)},[e,a]);const V=()=>{O(null),J(null)};return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsxs)(n.A,{container:!0,spacing:3,children:[(0,G.jsx)(n.A,{item:!0,xs:12,md:8,children:o?(0,G.jsx)(s.A,{sx:{aspectRatio:"16/9",width:"100%",bgcolor:"rgba(0,0,0,0.1)",borderRadius:2}}):(0,G.jsxs)(G.Fragment,{children:[(0,G.jsxs)(s.A,{sx:{position:"relative",overflow:"hidden",borderRadius:2,mb:2,maxHeight:"500px",display:"flex",justifyContent:"center",bgcolor:"#f5f5f5"},children:[r.image&&(0,G.jsx)("img",{src:r.image,alt:r.name,style:{width:"100%",height:"100%",objectFit:"contain",maxHeight:"500px"}}),r.created_at&&(0,G.jsx)(c.A,{label:new Date(r.created_at).getUTCFullYear(),sx:{position:"absolute",top:12,left:12,bgcolor:"#f6b033",color:"black"}})]}),(0,G.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[(0,G.jsx)(s.A,{sx:{bgcolor:(Y=r.rating,Y?"#ffcc33":"#000000ff"),color:"white",width:50,height:50,borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"900",fontSize:"1.5rem",boxShadow:2},children:r.rating||"-"}),(0,G.jsx)(l.A,{variant:"h4",gutterBottom:!0,sx:{fontWeight:"bold",mb:0},children:r.name})]}),(0,G.jsx)(l.A,{variant:"body1",sx:{color:"text.secondary",lineHeight:1.8,whiteSpace:"pre-line"},children:r.description||"Sem descri\xe7\xe3o dispon\xedvel."}),(0,G.jsxs)(s.A,{sx:{mt:6},children:[(0,G.jsx)(l.A,{variant:"h5",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Avalia\xe7\xf5es da Comunidade"}),(0,G.jsx)(d.A,{sx:{mb:3}}),r.reviews&&0!==r.reviews.length?(0,G.jsx)(n.A,{container:!0,spacing:2,children:r.reviews.map(e=>{var a,r,i,t,o;const d=P&&(P.id===e.user_id||1===P.role);return(0,G.jsx)(n.A,{item:!0,xs:12,children:(0,G.jsxs)(x.A,{elevation:0,sx:{p:2,bgcolor:"#f6b033",position:"relative"},children:[d&&(0,G.jsx)(s.A,{sx:{position:"absolute",top:8,right:8,zIndex:10},children:(0,G.jsx)(m.A,{"aria-label":"more",id:"long-button-".concat(e.id),"aria-haspopup":"true",onClick:a=>{return r=a,i=e.id,O(r.currentTarget),void J(i);var r,i},size:"small",sx:{bgcolor:"rgba(255,255,255,0.5)","&:hover":{bgcolor:"f6b033"}},children:(0,G.jsx)(B.A,{fontSize:"small"})})}),(0,G.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,G.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,G.jsx)(h.A,{src:null===(a=e.profiles)||void 0===a?void 0:a.avatar_url,alt:(null===(r=e.profiles)||void 0===r?void 0:r.full_name)||"Usu\xe1rio",sx:{width:32,height:32,bgcolor:"white",color:"#f6b033",fontSize:"0.9rem",fontWeight:"bold"},children:(null===(i=e.profiles)||void 0===i||null===(t=i.full_name)||void 0===t?void 0:t[0])||"U"}),(0,G.jsxs)(s.A,{children:[(0,G.jsx)(l.A,{variant:"subtitle2",fontWeight:"bold",sx:{color:"black",lineHeight:1},children:(null===(o=e.profiles)||void 0===o?void 0:o.full_name)||"Usu\xe1rio"}),(0,G.jsx)(l.A,{variant:"caption",sx:{color:"black"},children:new Date(e.created_at).toLocaleDateString()})]})]}),(0,G.jsxs)(s.A,{sx:{textAlign:"right",mr:d?5:0},children:[e.price_paid&&(0,G.jsx)(c.A,{icon:(0,G.jsx)(S.A,{style:{color:"black"}}),label:"R$ ".concat(e.price_paid),size:"small",sx:{bgcolor:"rgba(255,255,255,0.5)",color:"black",fontWeight:"bold",mr:.5,mb:.5}}),e.packaging&&(0,G.jsx)(c.A,{icon:(0,G.jsx)(W.A,{style:{color:"black"}}),label:e.packaging,size:"small",sx:{bgcolor:"rgba(255,255,255,0.3)",color:"black",mb:.5}})]})]}),(0,G.jsxs)(l.A,{variant:"body1",sx:{color:"black",mb:2,mt:1,fontWeight:500},children:['"',e.comment,'"']}),(0,G.jsxs)(s.A,{sx:{display:"flex",gap:2,opacity:.8,color:"black",flexWrap:"wrap"},children:[(0,G.jsxs)(l.A,{variant:"caption",children:["\ud83d\udc43 Aroma: ",(0,G.jsx)("b",{children:e.aroma}),"/10"]}),(0,G.jsxs)(l.A,{variant:"caption",children:["\ud83d\udc45 Sabor: ",(0,G.jsx)("b",{children:e.flavor}),"/20"]}),(0,G.jsxs)(l.A,{variant:"caption",children:["\ud83d\udc40 Apar\xeancia: ",(0,G.jsx)("b",{children:e.appearance}),"/5"]})]})]})},e.id)})}):(0,G.jsx)(l.A,{color:"text.secondary",children:"Seja o primeiro a avaliar esta cerveja!"})]})]})}),(0,G.jsxs)(n.A,{item:!0,xs:12,md:4,children:[(0,G.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Informa\xe7\xf5es"}),(0,G.jsx)(d.A,{sx:{mb:2,opacity:.6}}),o?(0,G.jsx)(l.A,{variant:"body2",children:"Carregando..."}):(0,G.jsxs)(s.A,{children:[(0,G.jsxs)(s.A,{sx:{mb:3},children:[(0,G.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,G.jsx)(y.A,{color:"primary",fontSize:"small"}),(0,G.jsx)(l.A,{variant:"subtitle1",sx:{fontWeight:"bold"},children:"Cervejaria:"})]}),(0,G.jsx)(l.A,{variant:"body1",sx:{color:"text.secondary",ml:4},children:r.brewery||"N\xe3o informada"})]}),(0,G.jsxs)(s.A,{sx:{mb:3},children:[(0,G.jsx)(l.A,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"Estilo:"}),r.style?(0,G.jsx)(c.A,{label:r.style,color:"primary"}):(0,G.jsx)(l.A,{variant:"body2",sx:{color:"text.secondary"},children:"Estilo n\xe3o informado."})]}),(0,G.jsxs)(n.A,{container:!0,spacing:2,sx:{mb:4},children:[(0,G.jsx)(n.A,{item:!0,xs:6,children:(0,G.jsxs)(x.A,{elevation:0,sx:{p:1.5,bgcolor:"#F6B033",borderRadius:2,textAlign:"center"},children:[(0,G.jsxs)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:.5,color:"black",mb:.5},children:[(0,G.jsx)(C.A,{fontSize:"small"}),(0,G.jsx)(l.A,{variant:"caption",fontWeight:"bold",children:"ABV"})]}),(0,G.jsx)(l.A,{variant:"h6",fontWeight:"bold",color:"black",children:r.abv?"".concat(r.abv,"%"):"-"})]})}),(0,G.jsx)(n.A,{item:!0,xs:6,children:(0,G.jsxs)(x.A,{elevation:0,sx:{p:1.5,bgcolor:"#F6B033",borderRadius:2,textAlign:"center"},children:[(0,G.jsxs)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:.5,color:"black",mb:.5},children:[(0,G.jsx)(_.A,{fontSize:"small"}),(0,G.jsx)(l.A,{variant:"caption",fontWeight:"bold",children:"IBU"})]}),(0,G.jsx)(l.A,{variant:"h6",fontWeight:"bold",color:"black",children:r.ibu||"-"})]})})]}),(0,G.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Avalia\xe7\xe3o Geral"}),(0,G.jsx)(d.A,{sx:{mb:2,opacity:.6}}),r.stats?(0,G.jsxs)(s.A,{sx:{bgcolor:"#f6b033",p:2,borderRadius:2,border:"1px solid #f6b033",mb:4},children:[(0,G.jsx)(H,{label:"Aroma",value:r.stats.avg_aroma,max:10}),(0,G.jsx)(H,{label:"Apar\xeancia",value:r.stats.avg_appearance,max:5}),(0,G.jsx)(H,{label:"Sabor",value:r.stats.avg_flavor,max:20}),(0,G.jsx)(H,{label:"Sensa\xe7\xe3o",value:r.stats.avg_mouthfeel,max:5}),(0,G.jsx)(H,{label:"Conjunto",value:r.stats.avg_impression,max:10}),(0,G.jsxs)(l.A,{variant:"caption",align:"center",display:"block",sx:{mt:1,color:"text.secondary"},children:["Baseado em ",r.reviews_count," avalia\xe7\xf5es"]})]}):(0,G.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:4},children:"Sem dados suficientes."}),(0,G.jsx)(s.A,{sx:{mb:4},children:L?(0,G.jsx)(T,{onSave:a=>{E(e,a),q(!1)},onCancel:()=>q(!1)}):(0,G.jsx)(u.A,{variant:"contained",color:"primary",fullWidth:!0,startIcon:(0,G.jsx)(k.A,{}),onClick:()=>q(!0),sx:{py:1.5,fontWeight:"bold"},children:"Avaliar esta Cerveja"})})]})]})]}),(0,G.jsx)(b.A,{open:Boolean(F),onClose:()=>U(null),maxWidth:"sm",fullWidth:!0,children:(0,G.jsx)(p.A,{children:F&&(0,G.jsx)(T,{initialData:F,onSave:a=>{N(F.id,e,a),U(null)},onCancel:()=>U(null)})})}),(0,G.jsxs)(g.A,{anchorEl:D,open:M,onClose:V,children:[(0,G.jsxs)(A.A,{onClick:()=>{const e=r.reviews.find(e=>e.id===$);e&&U(e),V()},children:[(0,G.jsx)(v.A,{children:(0,G.jsx)(R.A,{fontSize:"small"})}),(0,G.jsx)(f.A,{children:"Editar"})]}),(0,G.jsxs)(A.A,{onClick:async()=>{window.confirm("Tem certeza que deseja apagar sua avalia\xe7\xe3o?")&&await I($,e),V()},sx:{color:"error.main"},children:[(0,G.jsx)(v.A,{children:(0,G.jsx)(z.A,{fontSize:"small",color:"error"})}),(0,G.jsx)(f.A,{children:"Excluir"})]})]})]});var Y}},7381:(e,a,r)=>{r.d(a,{A:()=>c});var i=r(9379),t=r(5043),s=r(532),l=r(6547),o=r(8720),n=r(9099);const c=()=>{const[e,a]=t.useState([]),[r,c]=t.useState({}),[d,x]=t.useState(!1),{showToast:m}=(0,o.d)(),h=(0,t.useCallback)(async function(e,r,t){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"name_asc";x(!0);try{const{data:c,error:d}=await s.A.list("beer","*",e,r,t);if(d)throw d;if(c&&c.length>0){let e=await Promise.all(c.map(async e=>(e.image&&!e.image.startsWith("http")&&(e.image=await l.A.load(e.image,"beers")),e)));e=await(async e=>{const{data:a}=await n.N.from("beer_stats").select("*");return e.map(e=>{const r=null===a||void 0===a?void 0:a.find(a=>a.beer_id===e.id),t=r&&r.avg_price?Number(r.avg_price):0;return(0,i.A)((0,i.A)({},e),{},{rating:r?r.average_rating_10:null,reviews_count:r?r.review_count:0,avg_price:t})})})(e),e.sort((e,a)=>{const r=e.avg_price,i=a.avg_price,t=e.rating||0,s=a.rating||0;switch(o){case"price_asc":return 0===r?1:0===i?-1:r-i;case"price_desc":return i-r;case"rating_desc":return s-t;case"rating_asc":return t-s;case"name_desc":return a.name.localeCompare(e.name);default:return e.name.localeCompare(a.name)}}),a(e)}else a([])}catch(c){console.error("Erro ao listar:",c),a([])}finally{x(!1)}},[]),u=(0,t.useCallback)(async e=>{x(!0);try{const{data:a,error:r}=await s.A.get("beer",e);if(r)throw r;if(a){a.image&&!a.image.startsWith("http")&&(a.image=await l.A.load(a.image,"beers"));const{data:r}=await n.N.from("beer_stats").select("*").eq("beer_id",e).single(),{data:t}=await n.N.from("reviews").select("*, profiles:user_id(full_name, avatar_url)").eq("beer_id",e);let s=[];t&&t.length>0&&(s=await Promise.all(t.map(async e=>{var a;if(null!==(a=e.profiles)&&void 0!==a&&a.avatar_url&&!e.profiles.avatar_url.startsWith("http")){const a=await l.A.load(e.profiles.avatar_url,"images");e.profiles.avatar_url=a}return e}))),c((0,i.A)((0,i.A)({},a),{},{rating:r?r.average_rating_10:null,reviews_count:r?r.review_count:0,stats:r,reviews:s}))}}catch(a){c({})}finally{x(!1)}},[]),b=(0,t.useCallback)(async e=>{x(!0);try{const{data:a,error:r}=await n.N.from("reviews").select("*, beer:beer_id(id, name, image)").eq("user_id",e).order("created_at",{ascending:!1});if(r)throw r;if(a){return await Promise.all(a.map(async e=>(e.beer&&e.beer.image&&!e.beer.image.startsWith("http")&&(e.beer.image=await l.A.load(e.beer.image,"beers")),e)))}return[]}catch(a){return console.error("Erro ao buscar reviews do usu\xe1rio:",a),[]}finally{x(!1)}},[]),p=(0,t.useCallback)(async function(e,a,r,t){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;x(!0);try{let a,r=e.currentImagePath;if(e.image&&"object"===typeof e.image){const a=l.A.generateNameFile(e.name);r=await l.A.upload("beers",a,e.image)}e.year?a="".concat(e.year,"-01-01"):o||(a=new Date);const t=(0,i.A)({name:e.name,description:e.description,brewery:e.brewery,style:e.style,price:e.price,image:r},a?{created_at:a}:{});let c=null;if(o){c=(await s.A.update("beer",t,o)).error}else{c=(await s.A.create("beer",t)).error}if(c){var n;if("23505"===c.code||null!==(n=c.details)&&void 0!==n&&n.includes("already exists"))throw new Error("J\xe1 existe!");throw c}m("Salvo com sucesso!","success")}catch(c){m(c.message,"error")}finally{await h(a,r,t),x(!1)}},[h,m]),g=(0,t.useCallback)(async(e,a,r,i)=>{x(!0);try{const{error:a}=await s.A.delete("beer",e);if(a)throw a;m("Cerveja exclu\xedda!","success")}catch(t){m("Erro ao excluir.","error")}finally{await h(a,r,i),x(!1)}},[h,m]),A=(0,t.useCallback)(async(e,a)=>{x(!0);try{const{data:{user:r}}=await n.N.auth.getUser(),t=(0,i.A)((0,i.A)({beer_id:e,user_id:r.id},a),{},{price_paid:a.price_paid?Number(a.price_paid):null}),{error:s}=await n.N.from("reviews").insert(t);if(s)throw s;m("Avalia\xe7\xe3o enviada!","success"),await u(e)}catch(r){const e=r.message||"Erro desconhecido";m("Erro ao salvar: "+e,"error")}finally{x(!1)}},[u,m]),v=(0,t.useCallback)(async(e,a,r)=>{x(!0);try{const t=(0,i.A)((0,i.A)({},r),{},{price_paid:r.price_paid?Number(r.price_paid):null}),{error:s}=await n.N.from("reviews").update(t).eq("id",e);if(s)throw s;m("Avalia\xe7\xe3o atualizada!","success"),await u(a)}catch(t){m("Erro ao atualizar: "+t.message,"error")}finally{x(!1)}},[u,m]),f=(0,t.useCallback)(async(e,a)=>{x(!0);try{const{error:r}=await n.N.from("reviews").delete().eq("id",e);if(r)throw r;m("Avalia\xe7\xe3o exclu\xedda.","success"),await u(a)}catch(r){m("Erro ao excluir.","error")}finally{x(!1)}},[u,m]);return{listBeers:h,findBeer:u,saveBeer:p,deleteBeer:g,saveReview:A,updateReview:v,deleteReview:f,getUserReviews:b,beers:e,beer:r,loading:d}}}}]);
//# sourceMappingURL=991.cc9823bd.chunk.js.map