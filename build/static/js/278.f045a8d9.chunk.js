"use strict";(self.webpackChunkecos_project=self.webpackChunkecos_project||[]).push([[278],{278:(e,a,r)=>{r.r(a),r.d(a,{default:()=>N});var t=r(9379),i=r(5043),l=r(3969),s=r(256),n=r(9067),o=r(4938),c=r(7471),d=r(2555),u=r(298),g=r(6154),m=r(8578),h=r(2097),p=r(3023),x=r(1911),v=r(8776),b=r(5877),A=r(9992),w=r(579);const f=(0,A.A)((0,w.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");var y=r(4609),j=r(7381),_=r(8856),C=r(4990),W=r(9601);const S=["Todos","Pilsen","Lager","Pale Ale","IPA","Stout","Weiss","Sour","Witbier","Bock","Porter"],N=()=>{var e;const{beers:a,listBeers:r,loading:A,saveBeer:N,deleteBeer:k}=(0,j.A)(),{filter:P,doFilter:E}=(0,y.b)(),[B,I]=i.useState(!1),[T,z]=i.useState(null),[L,M]=i.useState("name_asc"),[R,F]=i.useState({name:"",description:"",brewery:"",style:"",year:"",image:null,currentImagePath:null}),[U,q]=i.useState(""),D=()=>{I(!1),F({name:"",description:"",brewery:"",style:"",year:"",image:null,currentImagePath:null}),q(""),z(null)},O=localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")).user:null,J=O&&1===O.role;return i.useEffect(()=>{r(P,50,1,L)},[P,r,L]),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(l.A,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mb:2,flexWrap:"wrap"},children:[(0,w.jsxs)(s.A,{size:"small",sx:{minWidth:150,bgcolor:"transparent",borderRadius:1},children:[(0,w.jsx)(n.A,{id:"style-select-label",children:"Estilo"}),(0,w.jsx)(o.A,{labelId:"style-select-label",value:(null===(e=P.style)||void 0===e?void 0:e.value)||"Todos",label:"Estilo",onChange:e=>E("style","Todos"===e.target.value?"":e.target.value),children:S.map(e=>(0,w.jsx)(c.A,{value:e,children:e},e))})]}),(0,w.jsxs)(s.A,{size:"small",sx:{minWidth:200,bgcolor:"transparent",borderRadius:1},children:[(0,w.jsx)(n.A,{id:"order-label",children:"Ordenar por"}),(0,w.jsxs)(o.A,{labelId:"order-label",value:L,label:"Ordenar por",onChange:e=>M(e.target.value),children:[(0,w.jsx)(c.A,{value:"name_asc",children:"Nome (A-Z)"}),(0,w.jsx)(c.A,{value:"name_desc",children:"Nome (Z-A)"}),(0,w.jsx)(c.A,{value:"rating_desc",children:"Maior Nota"}),(0,w.jsx)(c.A,{value:"rating_asc",children:"Menor Nota"}),(0,w.jsx)(c.A,{value:"price_asc",children:"Menor Pre\xe7o M\xe9dio"}),(0,w.jsx)(c.A,{value:"price_desc",children:"Maior Pre\xe7o M\xe9dio"})]})]})]}),(0,w.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",marginTop:2,marginLeft:"-16px",width:"calc(100% + 16px)"},children:A?Array.from({length:12}).map((e,a)=>(0,w.jsx)(l.A,{sx:{paddingLeft:"16px",paddingTop:"16px",flexBasis:{xs:"100%",sm:"50%",md:"33.333%",lg:"25%"},maxWidth:{xs:"100%",sm:"50%",md:"33.333%",lg:"25%"},boxSizing:"border-box"},children:(0,w.jsx)(W.A,{})},a)):0===a.length?(0,w.jsx)(l.A,{sx:{width:"100%",paddingLeft:"16px",paddingTop:"16px"},children:(0,w.jsx)(C.A,{title:"Nenhuma cerveja encontrada",subtitle:"Tente outro termo de busca."})}):a.map(e=>(0,w.jsx)(l.A,{sx:{paddingLeft:"16px",paddingTop:"16px",flexBasis:{xs:"100%",sm:"50%",md:"33.333%",lg:"25%"},maxWidth:{xs:"100%",sm:"50%",md:"33.333%",lg:"25%"},boxSizing:"border-box"},children:(0,w.jsx)(_.A,{beer:e,onEdit:()=>(e=>{z(e.id),F({name:e.name,description:e.description||"",brewery:e.brewery||"",style:e.style||"",year:e.created_at?new Date(e.created_at).getFullYear():"",image:null,currentImagePath:e.image}),q(e.image),I(!0)})(e),onDelete:()=>{return a=e.id,void(window.confirm("Tem certeza que deseja excluir esta cerveja?")&&k(a,P.name.value?P:null,50,1));var a}})},e.id))}),J&&(0,w.jsx)(d.A,{color:"primary","aria-label":"add",sx:{position:"fixed",right:"20px",bottom:"20px"},onClick:()=>{z(null),F({name:"",description:"",brewery:"",style:"",year:"",image:null,currentImagePath:null}),q(""),I(!0)},children:(0,w.jsx)(f,{})}),(0,w.jsxs)(p.A,{maxWidth:"sm",fullWidth:!0,open:B,onClose:D,children:[(0,w.jsx)(x.A,{children:T?"Editar Cerveja":"Adicionar Nova Cerveja"}),(0,w.jsx)(v.A,{children:(0,w.jsx)("form",{children:(0,w.jsxs)(u.A,{spacing:2,mt:1,children:[(0,w.jsx)(g.A,{label:"Nome da Cerveja",fullWidth:!0,value:R.name,onChange:e=>F(a=>(0,t.A)((0,t.A)({},a),{},{name:e.target.value}))}),(0,w.jsx)(g.A,{label:"Cervejaria / Fabricante",fullWidth:!0,value:R.brewery,onChange:e=>F(a=>(0,t.A)((0,t.A)({},a),{},{brewery:e.target.value}))}),(0,w.jsxs)(u.A,{direction:"row",spacing:2,children:[(0,w.jsx)(g.A,{label:"Estilo",fullWidth:!0,value:R.style,onChange:e=>F(a=>(0,t.A)((0,t.A)({},a),{},{style:e.target.value}))}),(0,w.jsx)(g.A,{label:"Ano de Cria\xe7\xe3o",type:"number",sx:{width:"150px"},value:R.year,onChange:e=>F(a=>(0,t.A)((0,t.A)({},a),{},{year:e.target.value}))})]}),(0,w.jsx)(g.A,{label:"Descri\xe7\xe3o",multiline:!0,rows:4,fullWidth:!0,value:R.description,onChange:e=>F(a=>(0,t.A)((0,t.A)({},a),{},{description:e.target.value}))}),(0,w.jsx)(g.A,{type:"file",fullWidth:!0,accept:"image/png, image/jpeg",onChange:e=>{const a=e.target.files[0];a&&(F(e=>(0,t.A)((0,t.A)({},e),{},{image:a})),q(URL.createObjectURL(a)))}}),U&&(0,w.jsx)(m.A,{sx:{height:"200px",width:"100%",borderRadius:"8px",backgroundSize:"contain"},image:U})]})})}),(0,w.jsxs)(b.A,{children:[(0,w.jsx)(h.A,{onClick:D,children:"Cancelar"}),(0,w.jsx)(h.A,{onClick:()=>{N(R,P.name.value?P:null,50,1,T),D()},variant:"contained",autoFocus:!0,children:"Salvar"})]})]})]})}},7381:(e,a,r)=>{r.d(a,{A:()=>c});var t=r(9379),i=r(5043),l=r(532),s=r(6547),n=r(8720),o=r(9099);const c=()=>{const[e,a]=i.useState([]),[r,c]=i.useState({}),[d,u]=i.useState(!1),{showToast:g}=(0,n.d)(),m=(0,i.useCallback)(async function(e,r,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"name_asc";u(!0);try{const{data:c,error:d}=await l.A.list("beer","*",e,r,i);if(d)throw d;if(c&&c.length>0){let e=await Promise.all(c.map(async e=>(e.image&&!e.image.startsWith("http")&&(e.image=await s.A.load(e.image,"beers")),e)));e=await(async e=>{const{data:a}=await o.N.from("beer_stats").select("*");return e.map(e=>{const r=null===a||void 0===a?void 0:a.find(a=>a.beer_id===e.id);return(0,t.A)((0,t.A)({},e),{},{rating:r?r.average_rating_10:null,reviews_count:r?r.review_count:0})})})(e),e.sort((e,a)=>{switch(n){case"price_asc":return(e.price||0)-(a.price||0);case"price_desc":return(a.price||0)-(e.price||0);case"rating_desc":return(a.rating||0)-(e.rating||0);case"rating_asc":return(e.rating||0)-(a.rating||0);case"name_desc":return a.name.localeCompare(e.name);default:return e.name.localeCompare(a.name)}}),a(e)}else a([])}catch(c){console.error("Erro ao listar:",c),a([])}finally{u(!1)}},[]),h=(0,i.useCallback)(async e=>{u(!0);try{const{data:a,error:r}=await l.A.get("beer",e);if(r)throw r;if(a){a.image&&!a.image.startsWith("http")&&(a.image=await s.A.load(a.image,"beers"));const{data:r}=await o.N.from("beer_stats").select("*").eq("beer_id",e).single(),{data:i}=await o.N.from("reviews").select("*, profiles:user_id(full_name, avatar_url)").eq("beer_id",e);let l=[];i&&i.length>0&&(l=await Promise.all(i.map(async e=>{var a;if(null!==(a=e.profiles)&&void 0!==a&&a.avatar_url&&!e.profiles.avatar_url.startsWith("http")){const a=await s.A.load(e.profiles.avatar_url,"images");e.profiles.avatar_url=a}return e}))),c((0,t.A)((0,t.A)({},a),{},{rating:r?r.average_rating_10:null,reviews_count:r?r.review_count:0,stats:r,reviews:l}))}}catch(a){c({})}finally{u(!1)}},[]),p=(0,i.useCallback)(async e=>{u(!0);try{const{data:a,error:r}=await o.N.from("reviews").select("*, beer:beer_id(id, name, image)").eq("user_id",e).order("created_at",{ascending:!1});if(r)throw r;if(a){return await Promise.all(a.map(async e=>(e.beer&&e.beer.image&&!e.beer.image.startsWith("http")&&(e.beer.image=await s.A.load(e.beer.image,"beers")),e)))}return[]}catch(a){return console.error("Erro ao buscar reviews do usu\xe1rio:",a),[]}finally{u(!1)}},[]),x=(0,i.useCallback)(async function(e,a,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;u(!0);try{let a,r=e.currentImagePath;if(e.image&&"object"===typeof e.image){const a=s.A.generateNameFile(e.name);r=await s.A.upload("beers",a,e.image)}e.year?a="".concat(e.year,"-01-01"):n||(a=new Date);const i=(0,t.A)({name:e.name,description:e.description,brewery:e.brewery,style:e.style,price:e.price,image:r},a?{created_at:a}:{});let c=null;if(n){c=(await l.A.update("beer",i,n)).error}else{c=(await l.A.create("beer",i)).error}if(c){var o;if("23505"===c.code||null!==(o=c.details)&&void 0!==o&&o.includes("already exists"))throw new Error("J\xe1 existe!");throw c}g("Salvo com sucesso!","success")}catch(c){g(c.message,"error")}finally{await m(a,r,i),u(!1)}},[m,g]),v=(0,i.useCallback)(async(e,a,r,t)=>{u(!0);try{const{error:a}=await l.A.delete("beer",e);if(a)throw a;g("Cerveja exclu\xedda!","success")}catch(i){g("Erro ao excluir.","error")}finally{await m(a,r,t),u(!1)}},[m,g]),b=(0,i.useCallback)(async(e,a)=>{u(!0);try{const{data:{user:r}}=await o.N.auth.getUser();if(!r)throw new Error("Usu\xe1rio n\xe3o logado.");const{error:i}=await o.N.from("reviews").insert((0,t.A)({beer_id:e,user_id:r.id},a));if(i)throw i;g("Nova avalia\xe7\xe3o registrada!","success"),await h(e)}catch(r){console.error("Erro ao avaliar:",r),g("Erro ao salvar avalia\xe7\xe3o: "+r.message,"error")}finally{u(!1)}},[h,g]);return{listBeers:m,findBeer:h,getUserReviews:p,saveBeer:x,deleteBeer:v,saveReview:b,beers:e,beer:r,loading:d}}}}]);
//# sourceMappingURL=278.f045a8d9.chunk.js.map