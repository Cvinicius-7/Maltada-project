"use strict";(self.webpackChunkecos_project=self.webpackChunkecos_project||[]).push([[991],{1991:(e,a,r)=>{r.r(a),r.d(a,{default:()=>P});var t=r(5043),i=r(8163),s=r(3969),l=r(5895),o=r(6020),n=r(3089),c=r(3759),d=r(4527),x=r(4799),m=r(7873),b=r(2097),h=r(7381),g=r(923),p=r(9243),u=r(7135),A=r(5727),f=r(9379),v=r(9958),j=r(298),y=r(6154),w=r(3699),_=r(7471),C=r(149),k=r(3974),S=r(579);const W=e=>{let{label:a,value:r,max:t,onChange:i}=e;return(0,S.jsxs)(s.A,{sx:{mb:2},children:[(0,S.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,S.jsx)(l.A,{variant:"body2",fontWeight:"bold",children:a}),(0,S.jsxs)(l.A,{variant:"body2",color:"primary",fontWeight:"bold",children:[r,"/",t]})]}),(0,S.jsx)(v.Ay,{value:r,onChange:(e,a)=>i(a),min:0,max:t,step:1,valueLabelDisplay:"auto",sx:{color:"#ffffff",height:6}})]})},B=["Garrafa (Long Neck)","Garrafa (600ml)","Garrafa (1L)","Lata (350ml)","Lata (473ml)","Barril / Chopp (On Tap)","Growler","Outro"],R=e=>{let{onSave:a,onCancel:r}=e;const[i,s]=(0,t.useState)({aroma:5,appearance:3,flavor:10,mouthfeel:3,impression:5}),[o,n]=(0,t.useState)({comment:"",packaging:"Garrafa (Long Neck)",price_paid:""});return(0,S.jsxs)(x.A,{elevation:3,sx:{p:3,mb:4,bgcolor:"#f6b033",borderRadius:2,border:"1px solid #f6b033"},children:[(0,S.jsx)(l.A,{variant:"h6",gutterBottom:!0,fontWeight:"bold",sx:{mb:3},children:"Escreva sua Avalia\xe7\xe3o"}),(0,S.jsx)(W,{label:"\ud83d\udc43 Aroma (0-10)",value:i.aroma,max:10,onChange:e=>s((0,f.A)((0,f.A)({},i),{},{aroma:e}))}),(0,S.jsx)(W,{label:"\ud83d\udc40 Apar\xeancia (0-5)",value:i.appearance,max:5,onChange:e=>s((0,f.A)((0,f.A)({},i),{},{appearance:e}))}),(0,S.jsx)(W,{label:"\ud83d\udc45 Sabor (0-20)",value:i.flavor,max:20,onChange:e=>s((0,f.A)((0,f.A)({},i),{},{flavor:e}))}),(0,S.jsx)(W,{label:"\ud83d\udc44 Sensa\xe7\xe3o na Boca (0-5)",value:i.mouthfeel,max:5,onChange:e=>s((0,f.A)((0,f.A)({},i),{},{mouthfeel:e}))}),(0,S.jsx)(W,{label:"\ud83e\udde0 Impress\xe3o Geral (0-10)",value:i.impression,max:10,onChange:e=>s((0,f.A)((0,f.A)({},i),{},{impression:e}))}),(0,S.jsxs)(j.A,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2,mt:3},children:[(0,S.jsx)(y.A,{select:!0,label:"Embalagem / Tipo",fullWidth:!0,value:o.packaging,onChange:e=>n((0,f.A)((0,f.A)({},o),{},{packaging:e.target.value})),InputProps:{startAdornment:(0,S.jsx)(w.A,{position:"start",children:(0,S.jsx)(C.A,{fontSize:"small"})})},children:B.map(e=>(0,S.jsx)(_.A,{value:e,children:e},e))}),(0,S.jsx)(y.A,{label:"Pre\xe7o Pago (R$)",type:"number",fullWidth:!0,placeholder:"0.00",value:o.price_paid,onChange:e=>n((0,f.A)((0,f.A)({},o),{},{price_paid:e.target.value})),InputProps:{startAdornment:(0,S.jsx)(w.A,{position:"start",children:(0,S.jsx)(k.A,{fontSize:"small"})})}})]}),(0,S.jsx)(y.A,{label:"Coment\xe1rio (Opcional)",placeholder:"O que voc\xea achou dessa cerveja?",multiline:!0,rows:3,fullWidth:!0,value:o.comment,onChange:e=>n((0,f.A)((0,f.A)({},o),{},{comment:e.target.value})),sx:{mb:3}}),(0,S.jsxs)(j.A,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,S.jsx)(b.A,{onClick:r,color:"inherit",children:"Cancelar"}),(0,S.jsx)(b.A,{variant:"contained",color:"primary",onClick:()=>{a((0,f.A)((0,f.A)({},i),{},{comment:o.comment,packaging:o.packaging,price_paid:o.price_paid}))},children:"Publicar Avalia\xe7\xe3o"})]})]})};var I=r(102),E=r(9138);const N=e=>{let{label:a,value:r,max:t}=e;return(0,S.jsxs)(s.A,{sx:{mb:1.5},children:[(0,S.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[(0,S.jsx)(l.A,{variant:"caption",fontWeight:"bold",children:a}),(0,S.jsxs)(l.A,{variant:"caption",color:"black",children:[r||0," / ",t]})]}),(0,S.jsx)(o.A,{variant:"determinate",value:(r||0)/t*100,sx:{height:6,borderRadius:4,bgcolor:"#fbc568ff","& .MuiLinearProgress-bar":{bgcolor:"black"}}})]})},P=()=>{const{id:e}=(0,i.g)(),{findBeer:a,beer:r,loading:o,saveReview:f}=(0,h.A)(),[v,j]=(0,t.useState)(!1);t.useEffect(()=>{a(e)},[e,a]);return(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)(n.A,{container:!0,spacing:3,children:[(0,S.jsx)(n.A,{item:!0,xs:12,md:8,children:o?(0,S.jsx)(s.A,{sx:{aspectRatio:"16/9",width:"100%",bgcolor:"rgba(0,0,0,0.1)",borderRadius:2}}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(s.A,{sx:{position:"relative",overflow:"hidden",borderRadius:2,mb:2,maxHeight:"500px",display:"flex",justifyContent:"center",bgcolor:"#f5f5f5"},children:[r.image&&(0,S.jsx)("img",{src:r.image,alt:r.name,style:{width:"100%",height:"100%",objectFit:"contain",maxHeight:"500px"}}),r.created_at&&(0,S.jsx)(c.A,{label:new Date(r.created_at).getUTCFullYear(),sx:{position:"absolute",top:12,left:12,bgcolor:"#f6b033",color:"#000000ff"}})]}),(0,S.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[(0,S.jsx)(s.A,{sx:{bgcolor:(y=r.rating,y?"#ffcc33":"#000000ff"),color:"#000000ff",width:50,height:50,borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"900",fontSize:"1.5rem",boxShadow:2},children:r.rating||"-"}),(0,S.jsx)(l.A,{variant:"h4",gutterBottom:!0,sx:{fontWeight:"bold",mb:0},children:r.name})]}),(0,S.jsx)(l.A,{variant:"body1",sx:{color:"text.secondary",lineHeight:1.8,whiteSpace:"pre-line"},children:r.description||"Sem descri\xe7\xe3o dispon\xedvel."}),(0,S.jsxs)(s.A,{sx:{mt:6},children:[(0,S.jsx)(l.A,{variant:"h5",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Avalia\xe7\xf5es da Comunidade"}),(0,S.jsx)(d.A,{sx:{mb:3}}),r.reviews&&0!==r.reviews.length?(0,S.jsx)(n.A,{container:!0,spacing:2,children:r.reviews.map(e=>{var a,r,t,i,o;return(0,S.jsx)(n.A,{item:!0,xs:12,children:(0,S.jsxs)(x.A,{elevation:0,sx:{p:2,bgcolor:"#f6b033"},children:[(0,S.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,S.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,S.jsx)(m.A,{src:null===(a=e.profiles)||void 0===a?void 0:a.avatar_url,alt:(null===(r=e.profiles)||void 0===r?void 0:r.full_name)||"Usu\xe1rio",sx:{width:32,height:32,bgcolor:"white",color:"#f6b033",fontSize:"0.9rem",fontWeight:"bold"},children:(null===(t=e.profiles)||void 0===t||null===(i=t.full_name)||void 0===i?void 0:i[0])||"U"}),(0,S.jsxs)(s.A,{children:[(0,S.jsx)(l.A,{variant:"subtitle2",fontWeight:"bold",sx:{color:"black",lineHeight:1},children:(null===(o=e.profiles)||void 0===o?void 0:o.full_name)||"Usu\xe1rio"}),(0,S.jsx)(l.A,{variant:"caption",sx:{color:"rgba(0,0,0,0.6)"},children:new Date(e.created_at).toLocaleDateString()})]})]}),(0,S.jsxs)(s.A,{sx:{textAlign:"right"},children:[e.price_paid&&(0,S.jsx)(c.A,{icon:(0,S.jsx)(I.A,{style:{color:"black"}}),label:"R$ ".concat(e.price_paid),size:"small",sx:{bgcolor:"rgba(255,255,255,0.5)",color:"black",fontWeight:"bold",mr:.5,mb:.5}}),e.packaging&&(0,S.jsx)(c.A,{icon:(0,S.jsx)(E.A,{style:{color:"black"}}),label:e.packaging,size:"small",sx:{bgcolor:"rgba(255,255,255,0.3)",color:"black",mb:.5}})]})]}),(0,S.jsxs)(l.A,{variant:"body1",sx:{color:"black",mb:2,mt:1,fontWeight:500},children:['"',e.comment,'"']}),(0,S.jsxs)(s.A,{sx:{display:"flex",gap:2,opacity:.8,color:"black",flexWrap:"wrap",bgcolor:"rgba(0,0,0,0.05)",p:1,borderRadius:1},children:[(0,S.jsxs)(l.A,{variant:"caption",children:["\ud83d\udc43 Aroma: ",(0,S.jsx)("b",{children:e.aroma}),"/10"]}),(0,S.jsxs)(l.A,{variant:"caption",children:["\ud83d\udc45 Sabor: ",(0,S.jsx)("b",{children:e.flavor}),"/20"]}),(0,S.jsxs)(l.A,{variant:"caption",children:["\ud83d\udc40 Apar\xeancia: ",(0,S.jsx)("b",{children:e.appearance}),"/5"]}),(0,S.jsxs)(l.A,{variant:"caption",children:["\ud83d\udc44 Sensa\xe7\xe3o: ",(0,S.jsx)("b",{children:e.mouthfeel}),"/5"]}),(0,S.jsxs)(l.A,{variant:"caption",children:["\ud83e\udde0 Conjunto: ",(0,S.jsx)("b",{children:e.impression}),"/10"]})]})]})},e.id)})}):(0,S.jsx)(l.A,{color:"text.secondary",children:"Seja o primeiro a avaliar esta cerveja!"})]})]})}),(0,S.jsxs)(n.A,{item:!0,xs:12,md:4,children:[(0,S.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Informa\xe7\xf5es"}),(0,S.jsx)(d.A,{sx:{mb:2,opacity:.6}}),o?(0,S.jsx)(l.A,{variant:"body2",children:"Carregando..."}):(0,S.jsxs)(s.A,{children:[(0,S.jsxs)(s.A,{sx:{mb:3},children:[(0,S.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,S.jsx)(g.A,{color:"primary",fontSize:"small"}),(0,S.jsx)(l.A,{variant:"subtitle1",sx:{fontWeight:"bold"},children:"Cervejaria:"})]}),(0,S.jsx)(l.A,{variant:"body1",sx:{color:"text.secondary",ml:4},children:r.brewery||"N\xe3o informada"})]}),(0,S.jsxs)(s.A,{sx:{mb:3},children:[(0,S.jsx)(l.A,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"Estilo:"}),r.style?(0,S.jsx)(c.A,{label:r.style,color:"primary"}):(0,S.jsx)(l.A,{variant:"body2",sx:{color:"text.secondary"},children:"Estilo n\xe3o informado."})]}),(0,S.jsxs)(n.A,{container:!0,spacing:2,sx:{mb:4},children:[(0,S.jsx)(n.A,{item:!0,xs:6,children:(0,S.jsxs)(x.A,{elevation:0,sx:{p:1.5,bgcolor:"#F6B033",borderRadius:2,textAlign:"center"},children:[(0,S.jsxs)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:.5,color:"black",mb:.5},children:[(0,S.jsx)(u.A,{fontSize:"small"}),(0,S.jsx)(l.A,{variant:"caption",fontWeight:"bold",children:"ABV"})]}),(0,S.jsx)(l.A,{variant:"h6",fontWeight:"bold",color:"black",children:r.abv?"".concat(r.abv,"%"):"-"})]})}),(0,S.jsx)(n.A,{item:!0,xs:6,children:(0,S.jsxs)(x.A,{elevation:0,sx:{p:1.5,bgcolor:"#F6B033",borderRadius:2,textAlign:"center"},children:[(0,S.jsxs)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:.5,color:"black",mb:.5},children:[(0,S.jsx)(p.A,{fontSize:"small"}),(0,S.jsx)(l.A,{variant:"caption",fontWeight:"bold",children:"IBU"})]}),(0,S.jsx)(l.A,{variant:"h6",fontWeight:"bold",color:"black",children:r.ibu||"-"})]})})]}),(0,S.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Avalia\xe7\xe3o Geral"}),(0,S.jsx)(d.A,{sx:{mb:2,opacity:.6}}),r.stats?(0,S.jsxs)(s.A,{sx:{bgcolor:"#F6B033",p:2,borderRadius:2,border:"1px solid #f6b033",mb:4},children:[(0,S.jsx)(N,{label:"Aroma",value:r.stats.avg_aroma,max:10}),(0,S.jsx)(N,{label:"Apar\xeancia",value:r.stats.avg_appearance,max:5}),(0,S.jsx)(N,{label:"Sabor",value:r.stats.avg_flavor,max:20}),(0,S.jsx)(N,{label:"Sensa\xe7\xe3o",value:r.stats.avg_mouthfeel,max:5}),(0,S.jsx)(N,{label:"Conjunto",value:r.stats.avg_impression,max:10}),(0,S.jsxs)(l.A,{variant:"caption",align:"center",display:"block",sx:{mt:1,color:"black"},children:["Baseado em ",r.reviews_count," avalia\xe7\xf5es"]})]}):(0,S.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:4},children:"Sem dados suficientes."}),(0,S.jsx)(s.A,{sx:{mb:4},children:v?(0,S.jsx)(R,{onSave:a=>{f(e,a),j(!1)},onCancel:()=>j(!1)}):(0,S.jsx)(b.A,{variant:"contained",color:"primary",fullWidth:!0,startIcon:(0,S.jsx)(A.A,{}),onClick:()=>j(!0),sx:{py:1.5,fontWeight:"bold"},children:"Avaliar esta Cerveja"})})]})]})]})});var y}},7381:(e,a,r)=>{r.d(a,{A:()=>c});var t=r(9379),i=r(5043),s=r(532),l=r(6547),o=r(8720),n=r(9099);const c=()=>{const[e,a]=i.useState([]),[r,c]=i.useState({}),[d,x]=i.useState(!1),{showToast:m}=(0,o.d)(),b=(0,i.useCallback)(async function(e,r,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"name_asc";x(!0);try{const{data:c,error:d}=await s.A.list("beer","*",e,r,i);if(d)throw d;if(c&&c.length>0){let e=await Promise.all(c.map(async e=>(e.image&&!e.image.startsWith("http")&&(e.image=await l.A.load(e.image,"beers")),e)));e=await(async e=>{const{data:a}=await n.N.from("beer_stats").select("*");return e.map(e=>{const r=null===a||void 0===a?void 0:a.find(a=>a.beer_id===e.id);return(0,t.A)((0,t.A)({},e),{},{rating:r?r.average_rating_10:null,reviews_count:r?r.review_count:0})})})(e),e.sort((e,a)=>{switch(o){case"price_asc":return(e.price||0)-(a.price||0);case"price_desc":return(a.price||0)-(e.price||0);case"rating_desc":return(a.rating||0)-(e.rating||0);case"rating_asc":return(e.rating||0)-(a.rating||0);case"name_desc":return a.name.localeCompare(e.name);default:return e.name.localeCompare(a.name)}}),a(e)}else a([])}catch(c){console.error("Erro ao listar:",c),a([])}finally{x(!1)}},[]),h=(0,i.useCallback)(async e=>{x(!0);try{const{data:a,error:r}=await s.A.get("beer",e);if(r)throw r;if(a){a.image&&!a.image.startsWith("http")&&(a.image=await l.A.load(a.image,"beers"));const{data:r}=await n.N.from("beer_stats").select("*").eq("beer_id",e).single(),{data:i}=await n.N.from("reviews").select("*, profiles:user_id(full_name, avatar_url)").eq("beer_id",e);let s=[];i&&i.length>0&&(s=await Promise.all(i.map(async e=>{var a;if(null!==(a=e.profiles)&&void 0!==a&&a.avatar_url&&!e.profiles.avatar_url.startsWith("http")){const a=await l.A.load(e.profiles.avatar_url,"images");e.profiles.avatar_url=a}return e}))),c((0,t.A)((0,t.A)({},a),{},{rating:r?r.average_rating_10:null,reviews_count:r?r.review_count:0,stats:r,reviews:s}))}}catch(a){c({})}finally{x(!1)}},[]),g=(0,i.useCallback)(async e=>{x(!0);try{const{data:a,error:r}=await n.N.from("reviews").select("*, beer:beer_id(id, name, image)").eq("user_id",e).order("created_at",{ascending:!1});if(r)throw r;if(a){return await Promise.all(a.map(async e=>(e.beer&&e.beer.image&&!e.beer.image.startsWith("http")&&(e.beer.image=await l.A.load(e.beer.image,"beers")),e)))}return[]}catch(a){return console.error("Erro ao buscar reviews do usu\xe1rio:",a),[]}finally{x(!1)}},[]),p=(0,i.useCallback)(async function(e,a,r,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;x(!0);try{let a,r=e.currentImagePath;if(e.image&&"object"===typeof e.image){const a=l.A.generateNameFile(e.name);r=await l.A.upload("beers",a,e.image)}e.year?a="".concat(e.year,"-01-01"):o||(a=new Date);const i=(0,t.A)({name:e.name,description:e.description,brewery:e.brewery,style:e.style,price:e.price,image:r},a?{created_at:a}:{});let c=null;if(o){c=(await s.A.update("beer",i,o)).error}else{c=(await s.A.create("beer",i)).error}if(c){var n;if("23505"===c.code||null!==(n=c.details)&&void 0!==n&&n.includes("already exists"))throw new Error("J\xe1 existe!");throw c}m("Salvo com sucesso!","success")}catch(c){m(c.message,"error")}finally{await b(a,r,i),x(!1)}},[b,m]),u=(0,i.useCallback)(async(e,a,r,t)=>{x(!0);try{const{error:a}=await s.A.delete("beer",e);if(a)throw a;m("Cerveja exclu\xedda!","success")}catch(i){m("Erro ao excluir.","error")}finally{await b(a,r,t),x(!1)}},[b,m]),A=(0,i.useCallback)(async(e,a)=>{x(!0);try{const{data:{user:r}}=await n.N.auth.getUser();if(!r)throw new Error("Usu\xe1rio n\xe3o logado.");const{error:i}=await n.N.from("reviews").insert((0,t.A)({beer_id:e,user_id:r.id},a));if(i)throw i;m("Nova avalia\xe7\xe3o registrada!","success"),await h(e)}catch(r){console.error("Erro ao avaliar:",r),m("Erro ao salvar avalia\xe7\xe3o: "+r.message,"error")}finally{x(!1)}},[h,m]);return{listBeers:b,findBeer:h,getUserReviews:g,saveBeer:p,deleteBeer:u,saveReview:A,beers:e,beer:r,loading:d}}}}]);
//# sourceMappingURL=991.a8d41ca7.chunk.js.map