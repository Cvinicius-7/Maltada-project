"use strict";(self.webpackChunkecos_project=self.webpackChunkecos_project||[]).push([[855],{3236:(e,r,t)=>{t.r(r),t.d(r,{default:()=>C});var a=t(5043),i=t(5895),n=t(9806),o=t(3969),s=t(3089),l=t(4799),c=t(7873),d=t(3759),h=t(4527),p=t(298),m=t(2097),x=t(8729),g=t(5767),u=t(160),v=t(9992),f=t(579);const A=(0,v.A)([(0,f.jsx)("path",{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6"},"0"),(0,f.jsx)("path",{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12m0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17"},"1")],"AdminPanelSettings"),b=(0,v.A)((0,f.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Email"),w=(0,v.A)((0,f.jsx)("path",{d:"M20 7h-5V4c0-1.1-.9-2-2-2h-2c-1.1 0-2 .9-2 2v3H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2M9 12c.83 0 1.5.67 1.5 1.5S9.83 15 9 15s-1.5-.67-1.5-1.5S8.17 12 9 12m3 6H6v-.75c0-1 2-1.5 3-1.5s3 .5 3 1.5zm1-9h-2V4h2zm5 7.5h-4V15h4zm0-3h-4V12h4z"}),"Badge");var y=t(5727),j=t(8163),_=t(5272),S=t(7381);const C=()=>{const e=(0,j.Zp)(),{logout:r}=(0,x.A)(),t=localStorage.getItem("user"),v=t?JSON.parse(t).user:null,{getUserReviews:C,loading:I}=(0,S.A)(),[k,R]=(0,a.useState)([]),[N,W]=(0,a.useState)(5);if((0,a.useEffect)(()=>{null!==v&&void 0!==v&&v.id&&C(v.id).then(e=>R(e))},[]),!v)return(0,f.jsx)(i.A,{children:"Carregando perfil..."});const M=1===v.role,z=M?"Administrador":"Cervejeiro",E=M?"secondary":"primary",L=v.email||"Email n\xe3o dispon\xedvel",V=v.email?v.email[0].toUpperCase():"U",D=e=>((e.aroma+e.appearance+e.flavor+e.mouthfeel+e.impression)/5).toFixed(1);return(0,f.jsxs)(n.A,{maxWidth:"md",children:[(0,f.jsx)(o.A,{sx:{mb:4,textAlign:"center"},children:(0,f.jsx)(i.A,{variant:"h4",sx:{fontWeight:"bold",color:"#f6b033"},children:"Meu Perfil"})}),(0,f.jsx)(s.A,{container:!0,spacing:3,justifyContent:"center",children:(0,f.jsx)(s.A,{item:!0,xs:12,md:8,children:(0,f.jsxs)(l.A,{elevation:3,sx:{p:4,borderRadius:4},children:[(0,f.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:4},children:[(0,f.jsx)(c.A,{src:v.avatar_url,sx:{width:120,height:120,bgcolor:"#f6b033",fontSize:"3.5rem",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",mb:2,color:"#fff"},children:V}),(0,f.jsx)(i.A,{variant:"h5",sx:{fontWeight:"bold"},children:v.full_name||v.email.split("@")[0]}),(0,f.jsx)(d.A,{icon:M?(0,f.jsx)(A,{}):(0,f.jsx)(u.A,{}),label:z,color:E,variant:"outlined",sx:{mt:1,fontWeight:"bold"}})]}),(0,f.jsx)(h.A,{sx:{mb:4},children:"Dados da Conta"}),(0,f.jsxs)(p.A,{spacing:3,children:[(0,f.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,f.jsx)(c.A,{sx:{bgcolor:"rgba(0,0,0,0.05)",color:"text.secondary"},children:(0,f.jsx)(b,{})}),(0,f.jsxs)(o.A,{children:[(0,f.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"E-mail"}),(0,f.jsx)(i.A,{variant:"body1",children:L})]})]}),(0,f.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,f.jsx)(c.A,{sx:{bgcolor:"rgba(0,0,0,0.05)",color:"text.secondary"},children:(0,f.jsx)(w,{})}),(0,f.jsxs)(o.A,{children:[(0,f.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"ID de Usu\xe1rio"}),(0,f.jsx)(i.A,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.9rem"},children:v.id})]})]})]}),(0,f.jsx)(h.A,{sx:{my:4}}),(0,f.jsxs)(p.A,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"center",children:[(0,f.jsx)(m.A,{variant:"outlined",color:"primary",startIcon:(0,f.jsx)(u.A,{}),onClick:()=>e("/edit-profile"),sx:{borderRadius:2,px:4,textTransform:"none"},children:"Editar Dados"}),(0,f.jsx)(m.A,{variant:"contained",color:"error",startIcon:(0,f.jsx)(g.A,{}),onClick:r,sx:{borderRadius:2,px:4,textTransform:"none"},children:"Sair da Conta"})]}),(0,f.jsx)(h.A,{sx:{mb:4,mt:4}}),(0,f.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[(0,f.jsx)(y.A,{color:"primary"}),(0,f.jsxs)(i.A,{variant:"h6",fontWeight:"bold",children:["Minhas Avalia\xe7\xf5es (",k.length,")"]})]}),I?(0,f.jsx)(i.A,{children:"Carregando avalia\xe7\xf5es..."}):0===k.length?(0,f.jsx)(i.A,{color:"text.secondary",align:"center",sx:{py:2},children:"Voc\xea ainda n\xe3o avaliou nenhuma cerveja."}):(0,f.jsxs)(p.A,{spacing:2,children:[k.slice(0,N).map(r=>{var t,a;return(0,f.jsxs)(l.A,{elevation:0,sx:{p:2,border:"1px solid #eee",display:"flex",gap:2,alignItems:"flex-start",cursor:"pointer","&:hover":{bgcolor:"#f6af3370"}},onClick:()=>e("/beer/".concat(r.beer_id)),children:[(0,f.jsx)(c.A,{src:null===(t=r.beer)||void 0===t?void 0:t.image,variant:"rounded",sx:{width:60,height:60,bgcolor:"rgba(0,0,0,0.05)"},children:"\ud83c\udf7a"}),(0,f.jsxs)(o.A,{sx:{flex:1},children:[(0,f.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,f.jsx)(i.A,{variant:"subtitle1",fontWeight:"bold",children:(null===(a=r.beer)||void 0===a?void 0:a.name)||"Cerveja"}),(0,f.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,f.jsx)(i.A,{fontWeight:"bold",color:"primary",children:D(r)}),(0,f.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"/ 10"})]})]}),(0,f.jsxs)(i.A,{variant:"body2",color:"text.secondary",sx:{mb:1,fontStyle:"italic"},children:['"',r.comment,'"']}),(0,f.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:["Avaliado em"," ",new Date(r.created_at).toLocaleDateString()]})]})]},r.id)}),k.length>N&&(0,f.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,f.jsxs)(m.A,{variant:"text",onClick:()=>{W(e=>e+5)},endIcon:(0,f.jsx)(_.A,{}),sx:{color:"text.secondary",textTransform:"none"},children:["Mostrar avalia\xe7\xf5es anteriores (",k.length-N," restantes)"]})})]})]})})})]})}},4527:(e,r,t)=>{t.d(r,{A:()=>v});var a=t(9379),i=t(45),n=t(5043),o=t(8387),s=t(1807),l=t(8128),c=t(1612),d=t(8301),h=t(4171),p=t(579);const m=["absolute","children","className","orientation","component","flexItem","light","role","textAlign","variant"],x=(0,l.Ay)("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,r)=>{const{ownerState:t}=e;return[r.root,t.absolute&&r.absolute,r[t.variant],t.light&&r.light,"vertical"===t.orientation&&r.vertical,t.flexItem&&r.flexItem,t.children&&r.withChildren,t.children&&"vertical"===t.orientation&&r.withChildrenVertical,"right"===t.textAlign&&"vertical"!==t.orientation&&r.textAlignRight,"left"===t.textAlign&&"vertical"!==t.orientation&&r.textAlignLeft]}})((0,c.A)(e=>{let{theme:r}=e;return{margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(r.vars||r).palette.divider,borderBottomWidth:"thin",variants:[{props:{absolute:!0},style:{position:"absolute",bottom:0,left:0,width:"100%"}},{props:{light:!0},style:{borderColor:r.alpha((r.vars||r).palette.divider,.08)}},{props:{variant:"inset"},style:{marginLeft:72}},{props:{variant:"middle",orientation:"horizontal"},style:{marginLeft:r.spacing(2),marginRight:r.spacing(2)}},{props:{variant:"middle",orientation:"vertical"},style:{marginTop:r.spacing(1),marginBottom:r.spacing(1)}},{props:{orientation:"vertical"},style:{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"}},{props:{flexItem:!0},style:{alignSelf:"stretch",height:"auto"}},{props:e=>{let{ownerState:r}=e;return!!r.children},style:{display:"flex",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}}},{props:e=>{let{ownerState:r}=e;return r.children&&"vertical"!==r.orientation},style:{"&::before, &::after":{width:"100%",borderTop:"thin solid ".concat((r.vars||r).palette.divider),borderTopStyle:"inherit"}}},{props:e=>{let{ownerState:r}=e;return"vertical"===r.orientation&&r.children},style:{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:"thin solid ".concat((r.vars||r).palette.divider),borderLeftStyle:"inherit"}}},{props:e=>{let{ownerState:r}=e;return"right"===r.textAlign&&"vertical"!==r.orientation},style:{"&::before":{width:"90%"},"&::after":{width:"10%"}}},{props:e=>{let{ownerState:r}=e;return"left"===r.textAlign&&"vertical"!==r.orientation},style:{"&::before":{width:"10%"},"&::after":{width:"90%"}}}]}})),g=(0,l.Ay)("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,r)=>{const{ownerState:t}=e;return[r.wrapper,"vertical"===t.orientation&&r.wrapperVertical]}})((0,c.A)(e=>{let{theme:r}=e;return{display:"inline-block",paddingLeft:"calc(".concat(r.spacing(1)," * 1.2)"),paddingRight:"calc(".concat(r.spacing(1)," * 1.2)"),whiteSpace:"nowrap",variants:[{props:{orientation:"vertical"},style:{paddingTop:"calc(".concat(r.spacing(1)," * 1.2)"),paddingBottom:"calc(".concat(r.spacing(1)," * 1.2)")}}]}})),u=n.forwardRef(function(e,r){const t=(0,d.b)({props:e,name:"MuiDivider"}),{absolute:n=!1,children:l,className:c,orientation:u="horizontal",component:v=(l||"vertical"===u?"div":"hr"),flexItem:f=!1,light:A=!1,role:b=("hr"!==v?"separator":void 0),textAlign:w="center",variant:y="fullWidth"}=t,j=(0,i.A)(t,m),_=(0,a.A)((0,a.A)({},t),{},{absolute:n,component:v,flexItem:f,light:A,orientation:u,role:b,textAlign:w,variant:y}),S=(e=>{const{absolute:r,children:t,classes:a,flexItem:i,light:n,orientation:o,textAlign:l,variant:c}=e,d={root:["root",r&&"absolute",c,n&&"light","vertical"===o&&"vertical",i&&"flexItem",t&&"withChildren",t&&"vertical"===o&&"withChildrenVertical","right"===l&&"vertical"!==o&&"textAlignRight","left"===l&&"vertical"!==o&&"textAlignLeft"],wrapper:["wrapper","vertical"===o&&"wrapperVertical"]};return(0,s.A)(d,h.K,a)})(_);return(0,p.jsx)(x,(0,a.A)((0,a.A)({as:v,className:(0,o.A)(S.root,c),role:b,ref:r,ownerState:_,"aria-orientation":"separator"!==b||"hr"===v&&"vertical"!==u?void 0:u},j),{},{children:l?(0,p.jsx)(g,{className:S.wrapper,ownerState:_,children:l}):null}))});u&&(u.muiSkipListHighlight=!0);const v=u},5272:(e,r,t)=>{t.d(r,{A:()=>n});var a=t(9992),i=t(579);const n=(0,a.A)((0,i.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore")},5727:(e,r,t)=>{t.d(r,{A:()=>n});var a=t(9992),i=t(579);const n=(0,a.A)((0,i.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 14v-2.47l6.88-6.88c.2-.2.51-.2.71 0l1.77 1.77c.2.2.2.51 0 .71L8.47 14zm12 0h-7.5l2-2H18z"}),"RateReview")},7381:(e,r,t)=>{t.d(r,{A:()=>c});var a=t(9379),i=t(5043),n=t(532),o=t(6547),s=t(8720),l=t(9099);const c=()=>{const[e,r]=i.useState([]),[t,c]=i.useState({}),[d,h]=i.useState(!1),{showToast:p}=(0,s.d)(),m=(0,i.useCallback)(async function(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"name_asc";h(!0);try{const{data:c,error:d}=await n.A.list("beer","*",e,t,i);if(d)throw d;if(c&&c.length>0){let e=await Promise.all(c.map(async e=>(e.image&&!e.image.startsWith("http")&&(e.image=await o.A.load(e.image,"beers")),e)));e=await(async e=>{const{data:r}=await l.N.from("beer_stats").select("*");return e.map(e=>{const t=null===r||void 0===r?void 0:r.find(r=>r.beer_id===e.id),i=t&&t.avg_price?Number(t.avg_price):0;return(0,a.A)((0,a.A)({},e),{},{rating:t?t.average_rating_10:null,reviews_count:t?t.review_count:0,avg_price:i})})})(e),e.sort((e,r)=>{const t=e.avg_price,a=r.avg_price,i=e.rating||0,n=r.rating||0;switch(s){case"price_asc":return 0===t?1:0===a?-1:t-a;case"price_desc":return a-t;case"rating_desc":return n-i;case"rating_asc":return i-n;case"name_desc":return r.name.localeCompare(e.name);default:return e.name.localeCompare(r.name)}}),r(e)}else r([])}catch(c){console.error("Erro ao listar:",c),r([])}finally{h(!1)}},[]),x=(0,i.useCallback)(async e=>{h(!0);try{const{data:r,error:t}=await n.A.get("beer",e);if(t)throw t;if(r){r.image&&!r.image.startsWith("http")&&(r.image=await o.A.load(r.image,"beers"));const{data:t}=await l.N.from("beer_stats").select("*").eq("beer_id",e).single(),{data:i}=await l.N.from("reviews").select("*, profiles:user_id(full_name, avatar_url)").eq("beer_id",e);let n=[];i&&i.length>0&&(n=await Promise.all(i.map(async e=>{var r;if(null!==(r=e.profiles)&&void 0!==r&&r.avatar_url&&!e.profiles.avatar_url.startsWith("http")){const r=await o.A.load(e.profiles.avatar_url,"images");e.profiles.avatar_url=r}return e}))),c((0,a.A)((0,a.A)({},r),{},{rating:t?t.average_rating_10:null,reviews_count:t?t.review_count:0,stats:t,reviews:n}))}}catch(r){c({})}finally{h(!1)}},[]),g=(0,i.useCallback)(async e=>{h(!0);try{const{data:r,error:t}=await l.N.from("reviews").select("*, beer:beer_id(id, name, image)").eq("user_id",e).order("created_at",{ascending:!1});if(t)throw t;if(r){return await Promise.all(r.map(async e=>(e.beer&&e.beer.image&&!e.beer.image.startsWith("http")&&(e.beer.image=await o.A.load(e.beer.image,"beers")),e)))}return[]}catch(r){return console.error("Erro ao buscar reviews do usu\xe1rio:",r),[]}finally{h(!1)}},[]),u=(0,i.useCallback)(async function(e,r,t,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;h(!0);try{let r,t=e.currentImagePath;if(e.image&&"object"===typeof e.image){const r=o.A.generateNameFile(e.name);t=await o.A.upload("beers",r,e.image)}e.year?r="".concat(e.year,"-01-01"):s||(r=new Date);const i=(0,a.A)({name:e.name,description:e.description,brewery:e.brewery,style:e.style,price:e.price,image:t},r?{created_at:r}:{});let c=null;if(s){c=(await n.A.update("beer",i,s)).error}else{c=(await n.A.create("beer",i)).error}if(c){var l;if("23505"===c.code||null!==(l=c.details)&&void 0!==l&&l.includes("already exists"))throw new Error("J\xe1 existe!");throw c}p("Salvo com sucesso!","success")}catch(c){p(c.message,"error")}finally{await m(r,t,i),h(!1)}},[m,p]),v=(0,i.useCallback)(async(e,r,t,a)=>{h(!0);try{const{error:r}=await n.A.delete("beer",e);if(r)throw r;p("Cerveja exclu\xedda!","success")}catch(i){p("Erro ao excluir.","error")}finally{await m(r,t,a),h(!1)}},[m,p]),f=(0,i.useCallback)(async(e,r)=>{h(!0);try{const{data:{user:t}}=await l.N.auth.getUser(),i=(0,a.A)((0,a.A)({beer_id:e,user_id:t.id},r),{},{price_paid:r.price_paid?Number(r.price_paid):null}),{error:n}=await l.N.from("reviews").insert(i);if(n)throw n;p("Avalia\xe7\xe3o enviada!","success"),await x(e)}catch(t){const e=t.message||"Erro desconhecido";p("Erro ao salvar: "+e,"error")}finally{h(!1)}},[x,p]),A=(0,i.useCallback)(async(e,r,t)=>{h(!0);try{const i=(0,a.A)((0,a.A)({},t),{},{price_paid:t.price_paid?Number(t.price_paid):null}),{error:n}=await l.N.from("reviews").update(i).eq("id",e);if(n)throw n;p("Avalia\xe7\xe3o atualizada!","success"),await x(r)}catch(i){p("Erro ao atualizar: "+i.message,"error")}finally{h(!1)}},[x,p]),b=(0,i.useCallback)(async(e,r)=>{h(!0);try{const{error:t}=await l.N.from("reviews").delete().eq("id",e);if(t)throw t;p("Avalia\xe7\xe3o exclu\xedda.","success"),await x(r)}catch(t){p("Erro ao excluir.","error")}finally{h(!1)}},[x,p]);return{listBeers:m,findBeer:x,saveBeer:u,deleteBeer:v,saveReview:f,updateReview:A,deleteReview:b,getUserReviews:g,beers:e,beer:t,loading:d}}}}]);
//# sourceMappingURL=855.f06b67c6.chunk.js.map