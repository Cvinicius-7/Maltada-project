"use strict";(self.webpackChunkecos_project=self.webpackChunkecos_project||[]).push([[343],{343:(e,a,r)=>{r.r(a),r.d(a,{default:()=>W});var t=r(9379),i=r(5043),l=r(3969),s=r(256),n=r(9067),o=r(4938),c=r(7471),d=r(2555),u=r(298),m=r(6154),g=r(8578),p=r(2097),h=r(3023),v=r(1911),x=r(8776),b=r(5877),A=r(2950),w=r(4609),f=r(7381),y=r(8560),j=r(4990),_=r(9601),C=r(579);const N=["Todos","Pilsen","Lager","Pale Ale","IPA","Stout","Weiss","Sour","Witbier","Bock","Porter"],W=()=>{var e;const{beers:a,listBeers:r,loading:W,saveBeer:S,deleteBeer:k}=(0,f.A)(),{filter:E,doFilter:P}=(0,w.b)(),[B,I]=i.useState(!1),[T,z]=i.useState(null),[R,L]=i.useState("name_asc"),[M,q]=i.useState({name:"",description:"",brewery:"",style:"",year:"",image:null,currentImagePath:null}),[F,D]=i.useState(""),O=()=>{I(!1),q({name:"",description:"",brewery:"",style:"",year:"",image:null,currentImagePath:null}),D(""),z(null)},U=localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")).user:null,J=U&&1===U.role;return i.useEffect(()=>{r(E,50,1,R)},[E,r,R]),(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(l.A,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mb:2,flexWrap:"wrap"},children:[(0,C.jsxs)(s.A,{size:"small",sx:{minWidth:150,bgcolor:"transparent",borderRadius:1},children:[(0,C.jsx)(n.A,{id:"style-select-label",children:"Estilo"}),(0,C.jsx)(o.A,{labelId:"style-select-label",value:(null===(e=E.style)||void 0===e?void 0:e.value)||"Todos",label:"Estilo",onChange:e=>P("style","Todos"===e.target.value?"":e.target.value),children:N.map(e=>(0,C.jsx)(c.A,{value:e,children:e},e))})]}),(0,C.jsxs)(s.A,{size:"small",sx:{minWidth:200,bgcolor:"transparent",borderRadius:1},children:[(0,C.jsx)(n.A,{id:"order-label",children:"Ordenar por"}),(0,C.jsxs)(o.A,{labelId:"order-label",value:R,label:"Ordenar por",onChange:e=>L(e.target.value),children:[(0,C.jsx)(c.A,{value:"name_asc",children:"Nome (A-Z)"}),(0,C.jsx)(c.A,{value:"name_desc",children:"Nome (Z-A)"}),(0,C.jsx)(c.A,{value:"rating_desc",children:"Maior Nota"}),(0,C.jsx)(c.A,{value:"rating_asc",children:"Menor Nota"}),(0,C.jsx)(c.A,{value:"price_asc",children:"Menor Pre\xe7o M\xe9dio"}),(0,C.jsx)(c.A,{value:"price_desc",children:"Maior Pre\xe7o M\xe9dio"})]})]})]}),(0,C.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",marginTop:2,marginLeft:"-16px",width:"calc(100% + 16px)"},children:W?Array.from({length:12}).map((e,a)=>(0,C.jsx)(l.A,{sx:{paddingLeft:"16px",paddingTop:"16px",flexBasis:{xs:"100%",sm:"50%",md:"33.333%",lg:"25%"},maxWidth:{xs:"100%",sm:"50%",md:"33.333%",lg:"25%"},boxSizing:"border-box"},children:(0,C.jsx)(_.A,{})},a)):0===a.length?(0,C.jsx)(l.A,{sx:{width:"100%",paddingLeft:"16px",paddingTop:"16px"},children:(0,C.jsx)(j.A,{title:"Nenhuma cerveja encontrada",subtitle:"Tente outro termo de busca."})}):a.map(e=>(0,C.jsx)(l.A,{sx:{paddingLeft:"16px",paddingTop:"16px",flexBasis:{xs:"100%",sm:"50%",md:"33.333%",lg:"25%"},maxWidth:{xs:"100%",sm:"50%",md:"33.333%",lg:"25%"},boxSizing:"border-box"},children:(0,C.jsx)(y.A,{beer:e,onEdit:()=>(e=>{z(e.id),q({name:e.name,description:e.description||"",brewery:e.brewery||"",style:e.style||"",year:e.created_at?new Date(e.created_at).getFullYear():"",image:null,currentImagePath:e.image}),D(e.image),I(!0)})(e),onDelete:()=>{return a=e.id,void(window.confirm("Tem certeza que deseja excluir esta cerveja?")&&k(a,E.name.value?E:null,50,1));var a}})},e.id))}),J&&(0,C.jsx)(d.A,{color:"primary","aria-label":"add",sx:{position:"fixed",right:"20px",bottom:"20px"},onClick:()=>{z(null),q({name:"",description:"",brewery:"",style:"",year:"",image:null,currentImagePath:null}),D(""),I(!0)},children:(0,C.jsx)(A.A,{})}),(0,C.jsxs)(h.A,{maxWidth:"sm",fullWidth:!0,open:B,onClose:O,children:[(0,C.jsx)(v.A,{children:T?"Editar Cerveja":"Adicionar Nova Cerveja"}),(0,C.jsx)(x.A,{children:(0,C.jsx)("form",{children:(0,C.jsxs)(u.A,{spacing:2,mt:1,children:[(0,C.jsx)(m.A,{label:"Nome da Cerveja",fullWidth:!0,value:M.name,onChange:e=>q(a=>(0,t.A)((0,t.A)({},a),{},{name:e.target.value}))}),(0,C.jsx)(m.A,{label:"Cervejaria / Fabricante",fullWidth:!0,value:M.brewery,onChange:e=>q(a=>(0,t.A)((0,t.A)({},a),{},{brewery:e.target.value}))}),(0,C.jsxs)(u.A,{direction:"row",spacing:2,children:[(0,C.jsx)(m.A,{label:"Estilo",fullWidth:!0,value:M.style,onChange:e=>q(a=>(0,t.A)((0,t.A)({},a),{},{style:e.target.value}))}),(0,C.jsx)(m.A,{label:"Ano de Cria\xe7\xe3o",type:"number",sx:{width:"150px"},value:M.year,onChange:e=>q(a=>(0,t.A)((0,t.A)({},a),{},{year:e.target.value}))})]}),(0,C.jsx)(m.A,{label:"Descri\xe7\xe3o",multiline:!0,rows:4,fullWidth:!0,value:M.description,onChange:e=>q(a=>(0,t.A)((0,t.A)({},a),{},{description:e.target.value}))}),(0,C.jsx)(m.A,{type:"file",fullWidth:!0,accept:"image/png, image/jpeg",onChange:e=>{const a=e.target.files[0];a&&(q(e=>(0,t.A)((0,t.A)({},e),{},{image:a})),D(URL.createObjectURL(a)))}}),F&&(0,C.jsx)(g.A,{sx:{height:"200px",width:"100%",borderRadius:"8px",backgroundSize:"contain"},image:F})]})})}),(0,C.jsxs)(b.A,{children:[(0,C.jsx)(p.A,{onClick:O,children:"Cancelar"}),(0,C.jsx)(p.A,{onClick:()=>{S(M,E.name.value?E:null,50,1,T),O()},variant:"contained",autoFocus:!0,children:"Salvar"})]})]})]})}},2950:(e,a,r)=>{r.d(a,{A:()=>l});var t=r(9992),i=r(579);const l=(0,t.A)((0,i.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},7381:(e,a,r)=>{r.d(a,{A:()=>c});var t=r(9379),i=r(5043),l=r(532),s=r(6547),n=r(8720),o=r(9099);const c=()=>{const[e,a]=i.useState([]),[r,c]=i.useState({}),[d,u]=i.useState(!1),{showToast:m}=(0,n.d)(),g=(0,i.useCallback)(async function(e,r,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"name_asc";u(!0);try{const{data:c,error:d}=await l.A.list("beer","*",e,r,i);if(d)throw d;if(c&&c.length>0){let e=await Promise.all(c.map(async e=>(e.image&&!e.image.startsWith("http")&&(e.image=await s.A.load(e.image,"beers")),e)));e=await(async e=>{const{data:a}=await o.N.from("beer_stats").select("*");return e.map(e=>{const r=null===a||void 0===a?void 0:a.find(a=>a.beer_id===e.id),i=r&&r.avg_price?Number(r.avg_price):0;return(0,t.A)((0,t.A)({},e),{},{rating:r?r.average_rating_10:null,reviews_count:r?r.review_count:0,avg_price:i})})})(e),e.sort((e,a)=>{const r=e.avg_price,t=a.avg_price,i=e.rating||0,l=a.rating||0;switch(n){case"price_asc":return 0===r?1:0===t?-1:r-t;case"price_desc":return t-r;case"rating_desc":return l-i;case"rating_asc":return i-l;case"name_desc":return a.name.localeCompare(e.name);default:return e.name.localeCompare(a.name)}}),a(e)}else a([])}catch(c){console.error("Erro ao listar:",c),a([])}finally{u(!1)}},[]),p=(0,i.useCallback)(async e=>{u(!0);try{const{data:a,error:r}=await l.A.get("beer",e);if(r)throw r;if(a){a.image&&!a.image.startsWith("http")&&(a.image=await s.A.load(a.image,"beers"));const{data:r}=await o.N.from("beer_stats").select("*").eq("beer_id",e).single(),{data:i}=await o.N.from("reviews").select("*, profiles:user_id(full_name, avatar_url)").eq("beer_id",e);let l=[];i&&i.length>0&&(l=await Promise.all(i.map(async e=>{var a;if(null!==(a=e.profiles)&&void 0!==a&&a.avatar_url&&!e.profiles.avatar_url.startsWith("http")){const a=await s.A.load(e.profiles.avatar_url,"images");e.profiles.avatar_url=a}return e}))),c((0,t.A)((0,t.A)({},a),{},{rating:r?r.average_rating_10:null,reviews_count:r?r.review_count:0,stats:r,reviews:l}))}}catch(a){c({})}finally{u(!1)}},[]),h=(0,i.useCallback)(async e=>{u(!0);try{const{data:a,error:r}=await o.N.from("reviews").select("*, beer:beer_id(id, name, image)").eq("user_id",e).order("created_at",{ascending:!1});if(r)throw r;if(a){return await Promise.all(a.map(async e=>(e.beer&&e.beer.image&&!e.beer.image.startsWith("http")&&(e.beer.image=await s.A.load(e.beer.image,"beers")),e)))}return[]}catch(a){return console.error("Erro ao buscar reviews do usu\xe1rio:",a),[]}finally{u(!1)}},[]),v=(0,i.useCallback)(async function(e,a,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;u(!0);try{let a,r=e.currentImagePath;if(e.image&&"object"===typeof e.image){const a=s.A.generateNameFile(e.name);r=await s.A.upload("beers",a,e.image)}e.year?a="".concat(e.year,"-01-01"):n||(a=new Date);const i=(0,t.A)({name:e.name,description:e.description,brewery:e.brewery,style:e.style,price:e.price,image:r},a?{created_at:a}:{});let c=null;if(n){c=(await l.A.update("beer",i,n)).error}else{c=(await l.A.create("beer",i)).error}if(c){var o;if("23505"===c.code||null!==(o=c.details)&&void 0!==o&&o.includes("already exists"))throw new Error("J\xe1 existe!");throw c}m("Salvo com sucesso!","success")}catch(c){m(c.message,"error")}finally{await g(a,r,i),u(!1)}},[g,m]),x=(0,i.useCallback)(async(e,a,r,t)=>{u(!0);try{const{error:a}=await l.A.delete("beer",e);if(a)throw a;m("Cerveja exclu\xedda!","success")}catch(i){m("Erro ao excluir.","error")}finally{await g(a,r,t),u(!1)}},[g,m]),b=(0,i.useCallback)(async(e,a)=>{u(!0);try{const{data:{user:r}}=await o.N.auth.getUser(),i=(0,t.A)((0,t.A)({beer_id:e,user_id:r.id},a),{},{price_paid:a.price_paid?Number(a.price_paid):null}),{error:l}=await o.N.from("reviews").insert(i);if(l)throw l;m("Avalia\xe7\xe3o enviada!","success"),await p(e)}catch(r){const e=r.message||"Erro desconhecido";m("Erro ao salvar: "+e,"error")}finally{u(!1)}},[p,m]),A=(0,i.useCallback)(async(e,a,r)=>{u(!0);try{const i=(0,t.A)((0,t.A)({},r),{},{price_paid:r.price_paid?Number(r.price_paid):null}),{error:l}=await o.N.from("reviews").update(i).eq("id",e);if(l)throw l;m("Avalia\xe7\xe3o atualizada!","success"),await p(a)}catch(i){m("Erro ao atualizar: "+i.message,"error")}finally{u(!1)}},[p,m]),w=(0,i.useCallback)(async(e,a)=>{u(!0);try{const{error:r}=await o.N.from("reviews").delete().eq("id",e);if(r)throw r;m("Avalia\xe7\xe3o exclu\xedda.","success"),await p(a)}catch(r){m("Erro ao excluir.","error")}finally{u(!1)}},[p,m]);return{listBeers:g,findBeer:p,saveBeer:v,deleteBeer:x,saveReview:b,updateReview:A,deleteReview:w,getUserReviews:h,beers:e,beer:r,loading:d}}}}]);
//# sourceMappingURL=343.c54ba6ff.chunk.js.map